<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0-rc1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://example.com/source/index.md/index.html">
<meta property="og:site_name">
<meta property="og:locale">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/source/index.md/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-Hans","comments":"","permalink":"","path":"source/index.md/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title></title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title"></h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/" class="post-title-link" itemprop="url">项目实战集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-06-16 21:36:20 / Modified: 21:51:06" itemprop="dateCreated datePublished" datetime="2023-06-16T21:36:20+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h2><p>Linux ping 命令用于检测主机。</p>
<p>执行 ping 指令会使用 ICMP 传输协议，发出要求回应的信息，若远端主机的网络功能没有问题，就会回应该信息，因而得知该主机运作正常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-d 使用Socket的SO_DEBUG功能。</span><br><span class="line">-c &lt;完成次数&gt; 设置完成要求回应的次数。</span><br><span class="line">-f 极限检测。</span><br><span class="line">-i&lt;间隔秒数&gt; 指定收发信息的间隔时间。</span><br><span class="line">-I&lt;网络界面&gt; 使用指定的网络接口送出数据包。</span><br><span class="line">-l&lt;前置载入&gt; 设置在送出要求信息之前，先行发出的数据包。</span><br><span class="line">-n 只输出数值。</span><br><span class="line">-p&lt;范本样式&gt; 设置填满数据包的范本样式。</span><br><span class="line">-q 不显示指令执行过程，开头和结尾的相关信息除外。</span><br><span class="line">-r 忽略普通的Routing Table，直接将数据包送到远端主机上。</span><br><span class="line">-R 记录路由过程。</span><br><span class="line">-s&lt;数据包大小&gt; 设置数据包的大小。</span><br><span class="line">-t&lt;存活数值&gt; 设置存活数值TTL的大小。</span><br><span class="line">-v 详细显示指令的执行过程。</span><br><span class="line">-w &lt;deadline&gt; 在 deadline 秒后退出。</span><br></pre></td></tr></table></figure>

<h2 id="服务器状态检测脚本"><a href="#服务器状态检测脚本" class="headerlink" title="服务器状态检测脚本"></a>服务器状态检测脚本</h2><p>使用for循环判断主机是否存活：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ip_list=<span class="string">&quot;192.168.1.1 127.0.0.1 0.0.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="variable">$ip_list</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="keyword">for</span> count <span class="keyword">in</span> &#123;1..3&#125;;<span class="keyword">do</span></span><br><span class="line">                ping -c1 -w1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span> ping is ok&quot;</span></span><br><span class="line">                        <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$count</span> -eq 3 ];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span> ping is failure&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>使用while循环判断主机是否存活：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ip_list=&quot;192.168.1.1 127.0.0.1 0.0.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> ip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        count=1</span><br><span class="line">        <span class="keyword">while</span> [ <span class="variable">$count</span> -le 3 ];<span class="keyword">do</span></span><br><span class="line">                ping -c1 -w1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">                <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span> ping is ok&quot;</span></span><br><span class="line">                        <span class="built_in">break</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">                count=$((<span class="variable">$count</span>+<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$count</span> -eq 4 ];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span> ping is failure&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt;ip.txt</span><br></pre></td></tr></table></figure>

<h2 id="Nginx日志参数"><a href="#Nginx日志参数" class="headerlink" title="Nginx日志参数"></a>Nginx日志参数</h2><table>
<thead>
<tr>
<th>变量名称</th>
<th>变量描述</th>
<th>举例说明</th>
</tr>
</thead>
<tbody><tr>
<td>$remote_addr</td>
<td>客户端地址</td>
<td>113.140.15.90</td>
</tr>
<tr>
<td>$remote_user</td>
<td>客户端用户名称</td>
<td>–</td>
</tr>
<tr>
<td>$time_local</td>
<td>访问时间和时区</td>
<td>18&#x2F;Jul&#x2F;2012:17:00:01 +0800</td>
</tr>
<tr>
<td>$request</td>
<td>请求的URI和HTTP协议</td>
<td>“GET &#x2F;pa&#x2F;img&#x2F;home&#x2F;logo-alipay-t.png HTTP:&#x2F;1.1″</td>
</tr>
<tr>
<td>$http_host</td>
<td>请求地址，即浏览器中你输入的地址（IP或域名）</td>
<td>img.alipay.com10.253.70.103</td>
</tr>
<tr>
<td>$status</td>
<td>HTTP请求状态</td>
<td>200</td>
</tr>
<tr>
<td>$upstream_status</td>
<td>upstream状态</td>
<td>200</td>
</tr>
<tr>
<td>$body_bytes_sent</td>
<td>发送给客户端文件内容大小</td>
<td>547</td>
</tr>
<tr>
<td>$http_referer</td>
<td>跳转来源</td>
<td>“<a target="_blank" rel="noopener" href="https://cashier.alip/ay.com%E2%80%A6/%E2%80%9D">https://cashier.alip/ay.com…/”</a></td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>用户终端代理</td>
<td>“Mozilla&#x2F;4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; GTB7.0; .NET4.0C;</td>
</tr>
<tr>
<td>$ssl_protocol</td>
<td>SSL协议版本</td>
<td>TLSv1</td>
</tr>
<tr>
<td>$ssl_cipher</td>
<td>交换数据中的算法</td>
<td>RC4-SHA</td>
</tr>
<tr>
<td>$upstream_addr</td>
<td>后台upstream的地址，即真正提供服务的主机地址</td>
<td>10.228.35.247:80</td>
</tr>
<tr>
<td>$request_time</td>
<td>整个请求的总时间</td>
<td>0.205</td>
</tr>
<tr>
<td>$upstream_response_time</td>
<td>请求过程中，upstream响应时间</td>
<td>0.002</td>
</tr>
</tbody></table>
<h2 id="xargs命令"><a href="#xargs命令" class="headerlink" title="xargs命令"></a>xargs命令</h2><p><code>xargs</code>是给命令传递参数的一个过滤器，也是组合多个命令的一个工具。</p>
<p><code>xargs</code>可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。</p>
<h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-d &lt;定界符&gt;：指定输入项的定界符，默认为换行符。</span><br><span class="line">-I &lt;占位符&gt;：指定替代字符串，用于替换命令中的参数位置。</span><br><span class="line">-n &lt;数量&gt;：指定每次执行的参数数量。</span><br><span class="line">-t：显示实际执行的命令。</span><br><span class="line">-p：提示用户确认是否执行命令</span><br></pre></td></tr></table></figure>

<h3 id="通过cat命令理解xargs用法"><a href="#通过cat命令理解xargs用法" class="headerlink" title="通过cat命令理解xargs用法"></a>通过<code>cat</code>命令理解<code>xargs</code>用法</h3><ul>
<li><p>原始文件</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@sh:~<span class="comment"># cat file.txt</span></span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line">file3</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过管道符号讲标准输出转换为标准输入传递给cat</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@sh:~<span class="comment"># cat file.txt|cat</span></span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line">file3</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过管道符号和xargs将标准输出转换为参数传递给cat</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@sh:~<span class="comment"># cat file.txt|xargs cat</span></span><br><span class="line"><span class="built_in">cat</span>: file1: No such file or directory</span><br><span class="line"><span class="built_in">cat</span>: file2: No such file or directory</span><br><span class="line"><span class="built_in">cat</span>: file3: No such file or directory</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><ol>
<li><p>查找并打包日志</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.log&quot;</span> |xargs tar -cvzf log.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>对日志文件进行文字查找</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.log&quot;</span> |xargs grep -n <span class="string">&quot;error&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>批量创建目录</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find  /var/log -maxdepth 1 -<span class="built_in">type</span> d |xargs -I &#123;&#125; <span class="built_in">mkdir</span> .&#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="uniq命令"><a href="#uniq命令" class="headerlink" title="uniq命令"></a>uniq命令</h2><p>Linux uniq命令用于检查及删除文本文件中重复出现的行列，一般与 sort 命令结合使用。</p>
<p>uniq命令可检查文本文件中重复出现的行列。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-c或--count 在每列旁边显示该行重复出现的次数。</span><br><span class="line">-d或--repeated 仅显示重复出现的行列。</span><br><span class="line">-f&lt;栏位&gt;或--skip-fields=&lt;栏位&gt; 忽略比较指定的栏位。</span><br><span class="line">-s&lt;字符位置&gt;或--skip-chars=&lt;字符位置&gt; 忽略比较指定的字符。</span><br><span class="line">-u或--unique 仅显示出一次的行列。</span><br><span class="line">-w&lt;字符位置&gt;或--check-chars=&lt;字符位置&gt; 指定要比较的字符。</span><br><span class="line">--help 显示帮助。</span><br><span class="line">--version 显示版本信息。</span><br><span class="line">[输入文件] 指定已排序好的文本文件。如果不指定此项，则从标准读取数据；</span><br><span class="line">[输出文件] 指定输出的文件。如果不指定此选项，则将内容显示到标准输出设备（显示终端）</span><br></pre></td></tr></table></figure>

<p>文本文件包含以下内容：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Copy code</span><br><span class="line">apple</span><br><span class="line">banana</span><br><span class="line">apple</span><br><span class="line">orange</span><br><span class="line">orange</span><br><span class="line">apple</span><br></pre></td></tr></table></figure>

<p>使用<code>uniq -c</code>命令来统计重复行的次数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">uniq</span> -c data.txt</span><br><span class="line">      1 apple</span><br><span class="line">      1 banana</span><br><span class="line">      2 apple</span><br><span class="line">      2 orange</span><br><span class="line">      1 apple</span><br></pre></td></tr></table></figure>

<p>输出的每一行都包含两部分：重复行的次数和该行的内容。在上面的示例中，第一行的<code>apple</code>只出现了一次，第二行的<code>banana</code>只出现了一次，第三行的<code>apple</code>出现了两次，以此类推。</p>
<h2 id="多机部署MySQL"><a href="#多机部署MySQL" class="headerlink" title="多机部署MySQL"></a>多机部署MySQL</h2><h3 id="实验环境搭建"><a href="#实验环境搭建" class="headerlink" title="实验环境搭建"></a>实验环境搭建</h3><ol>
<li><p>配置<code>centos</code>虚拟机网络</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置ip地址和子网掩码</span></span><br><span class="line">sudo ifconfig [网口名] [ip]/24</span><br><span class="line"><span class="comment">## 配置默认网关</span></span><br><span class="line">sudo route add default gw [网关]</span><br><span class="line">ping baidu.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>本项目通过docker搭建实验环境，首先需要在<code>centos7</code>虚拟机中安装<code>docker</code><br>运行以下命令使用官方安装脚本自动安装Docker</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动docker服务</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过镜像<code>linuxserver/openssh-server</code>创建多个主机</p>
<ol>
<li><p>创建主机1，默认ssh端口号2222，主机名设置为host1，外部ssh端口号2221</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name host1\</span><br><span class="line"> -e PASSWORD_ACCESS=<span class="literal">true</span> \</span><br><span class="line"> -e USER_PASSWORD=password \</span><br><span class="line"> -e USER_NAME=demo \</span><br><span class="line"> -p 2221:2222 lscr.io/linuxserver/openssh-server:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建主机2，默认ssh端口号2222，主机名设置为host2，外部ssh端口号2222</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name host2 \</span><br><span class="line"> -e PASSWORD_ACCESS=<span class="literal">true</span> \</span><br><span class="line"> -e USER_PASSWORD=password \</span><br><span class="line"> -e USER_NAME=demo \</span><br><span class="line"> -p 2222:2222 lscr.io/linuxserver/openssh-server:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建主机3，默认ssh端口号2222，主机名设置为host3，外部ssh端口号2223</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name host3 \</span><br><span class="line"> -e PASSWORD_ACCESS=<span class="literal">true</span> \</span><br><span class="line"> -e USER_PASSWORD=password \</span><br><span class="line"> -e USER_NAME=demo \</span><br><span class="line"> -p 2223:2222 lscr.io/linuxserver/openssh-server:latest</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>通过<code>sudo docker ps</code>查看容器信息</p>
<p> <img src="/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86%20b1f29f1f66bb4b5791f43d861b5bb655/Untitled.png" alt="Untitled"></p>
</li>
<li><p>容器常用命令</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看当前运行的容器状态</span></span><br><span class="line">sudo docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment">## 停止容器</span></span><br><span class="line">sudo docker stop 容器名</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除容器</span></span><br><span class="line">sudo docker <span class="built_in">rm</span> 容器名</span><br><span class="line"></span><br><span class="line"><span class="comment">## 进入正在运行的容器</span></span><br><span class="line">sudo docker <span class="built_in">exec</span> -it 容器名 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">##从容器中退出</span></span><br><span class="line"><span class="built_in">exit</span>或者使用快捷键CTRL + p 然后CTRL + q</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过<code>ping -p 2221 localhost</code>验证centos和容器之间的网络</p>
</li>
<li><p>通过<code>ssh -p 2221 demo@localhost</code>验证ssh服务，使用用户名<code>demo</code>和密码<code>password</code>登录容器，在容器内使用exit断开ssh连接。</p>
</li>
</ol>
<h3 id="推送公钥到各个主机"><a href="#推送公钥到各个主机" class="headerlink" title="推送公钥到各个主机"></a>推送公钥到各个主机</h3><ul>
<li><p>ssh密钥登录原理</p>
<p>  我们一般使用 PuTTY 等 SSH 客户端来远程管理 Linux 服务器。但是，一般的密码方式登录，容易有密码被暴力破解的问题。所以，一般我们会将 SSH 的端口设置为默认的 22 以外的端口，或者禁用 root 账户登录。其实，有一个更好的办法来保证安全，而且让你可以放心地用 root 账户从远程登录——那就是通过密钥方式登录。</p>
<p>  密钥形式登录的原理是：利用密钥生成器制作一对密钥——一只公钥和一只私钥。将公钥添加到服务器的某个账户上，然后在客户端利用私钥即可完成认证并登录。</p>
</li>
</ul>
<ol>
<li><code>ssh-keygen</code>制作密钥对</li>
<li><code>ls ~/.ssh</code>查看密钥文件</li>
<li><code>ssh-copy-id -p 2221 demo@localhost</code> 推送公钥到目标主机</li>
<li><code>ssh -p 2221 demo@localhost</code>验证密钥登录</li>
</ol>
<h3 id="批量推送公钥"><a href="#批量推送公钥" class="headerlink" title="批量推送公钥"></a>批量推送公钥</h3><ol>
<li><p>centos虚拟机安装expect工具</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install expect</span><br></pre></td></tr></table></figure>

<p> <code>expect</code> 是一个用于自动化交互式命令行工具的工具集，它可以用于编写脚本来处理需要与外部程序进行交互的场景。以下是 <code>expect</code> 常用的命令和用法：</p>
<ol>
<li><p><code>spawn</code>：启动一个新的进程并与其进行交互。</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spawn ssh user@hostname</span><br></pre></td></tr></table></figure>

<p> 上述命令将启动一个 SSH 连接，并与远程主机进行交互。</p>
</li>
<li><p><code>expect</code>：匹配预期的输出或交互，并执行相应的操作。</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect <span class="string">&quot;password:&quot;</span></span><br><span class="line">send <span class="string">&quot;mypassword\r&quot;</span></span><br></pre></td></tr></table></figure>

<p> 上述命令会等待输出中出现 “password:”，然后发送密码。</p>
</li>
<li><p><code>send</code>：向进程发送字符串。</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send <span class="string">&quot;ls\r&quot;</span></span><br></pre></td></tr></table></figure>

<p> 上述命令会发送 “ls” 命令给进程。</p>
</li>
</ol>
</li>
<li><p>批量推送公钥脚本</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">port_list=<span class="string">&quot;2221 2223&quot;</span></span><br><span class="line">password=<span class="string">&quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$port_list</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        /usr/bin/expect -c <span class="string">&quot;</span></span><br><span class="line"><span class="string">                spawn ssh-copy-id -p <span class="variable">$i</span> demo@localhost</span></span><br><span class="line"><span class="string">                expect &#123;</span></span><br><span class="line"><span class="string">                \&quot;*connecting\&quot; &#123; send \&quot;yes\r\&quot;; exp_continue &#125; &#125;</span></span><br><span class="line"><span class="string">                expect &#123;</span></span><br><span class="line"><span class="string">                \&quot;*password\&quot; &#123; send \&quot;<span class="variable">$password</span>\r\&quot;; exp_continue &#125; &#125;</span></span><br><span class="line"><span class="string">                expect eof</span></span><br><span class="line"><span class="string">                &quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="多机部署MySQL脚本"><a href="#多机部署MySQL脚本" class="headerlink" title="多机部署MySQL脚本"></a>多机部署MySQL脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">port_list=<span class="string">&quot;2221 2222 2223&quot;</span></span><br><span class="line">password=<span class="string">&quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$port_list</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        ping -c1 -w1 -p <span class="variable">$i</span> localhost</span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">                /usr/bin/expect -c <span class="string">&quot;</span></span><br><span class="line"><span class="string">                spawn ssh -p <span class="variable">$i</span> demo@localhost \&quot;sudo apk add mysql mysql-client\&quot;      </span></span><br><span class="line"><span class="string">                expect &#123;</span></span><br><span class="line"><span class="string">                \&quot;*password\&quot; &#123; send \&quot;<span class="variable">$password</span>\r\&quot;;exp_continue&#125;&#125;</span></span><br><span class="line"><span class="string">                expect eof</span></span><br><span class="line"><span class="string">                &quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/16/linux_shell/11.%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/16/linux_shell/11.%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/" class="post-title-link" itemprop="url">系统资源性能瓶颈脚本构建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-06-16 21:35:08 / Modified: 21:46:20" itemprop="dateCreated datePublished" datetime="2023-06-16T21:35:08+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="常见的系统性能分析工具"><a href="#常见的系统性能分析工具" class="headerlink" title="常见的系统性能分析工具"></a>常见的系统性能分析工具</h2><ul>
<li>为什么利用Shell脚本进行系统资源性能分析<ol>
<li>在系统性能分析中，我们需要收集大量的数据并进行分析，而手动操作比较繁琐且容易出错，而且不易重复。使用shell脚本可以自动化执行这些操作，提高效率和准确性。</li>
<li>由于shell脚本的灵活性和可编程性，可以根据不同需求和环境对脚本进行维护和扩展，实现各种不同的性能分析操作，可以大大提高工作效率和准确性。</li>
</ol>
</li>
</ul>
<h3 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h3><p>vmstat是一个用于Linux系统的性能分析工具，它能够实时地监测CPU、内存、I&#x2F;O、交换分区等系统性能数据，并将这些数据以一定的时间间隔（默认为2秒）输出到终端或日志文件中，提供给用户进行分析和优化。</p>
<ul>
<li><p>vmstat输出信息含义：</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">r：等待运行的进程数目，即运行队列长度；</span><br><span class="line">b：处于不可中断状态（blocked）的进程数目；</span><br><span class="line">swpd：使用虚拟内存的大小，单位为KB；</span><br><span class="line">free：空闲物理内存的大小，单位为KB；</span><br><span class="line">buff：用作缓存的内存大小，单位为KB；</span><br><span class="line">cache：用作缓存的页缓存的大小，单位为KB；</span><br><span class="line">si：从磁盘交换入的内存大小，单位为KB/s；</span><br><span class="line">so：向磁盘交换出的内存大小，单位为KB/s；</span><br><span class="line">bi：从块设备读取的块数，单位为块/s；</span><br><span class="line">bo：向块设备写入的块数，单位为块/s；</span><br><span class="line">in：每秒中断数，包括时钟中断；</span><br><span class="line">cs：每秒上下文切换次数；</span><br><span class="line">us：用户进程占用CPU时间百分比；</span><br><span class="line">sy：系统内核占用CPU时间百分比；</span><br><span class="line">id：CPU空闲时间百分比；</span><br><span class="line">wa：等待I/O完成时间百分比;</span><br><span class="line">st：虚拟机占用CPU时间百分比；</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看系统的整体性能信息： <code>vmstat</code></p>
</li>
<li><p>每隔一段时间查看系统的整体性能信息： <code>vmstat 5 1</code></p>
</li>
<li><p>输出带有时间戳的系统整体性能信息： <code>vmstat -t</code></p>
</li>
<li><p>显示磁盘信息： <code>vmstat -d</code></p>
</li>
<li><p>显示指定的硬盘分区状态： <code>vmstat -p disk part</code></p>
</li>
<li><p>修改输出信息的单位： <code>vmstat -S M</code></p>
</li>
</ul>
<h3 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h3><p>iostat是一个常用的性能分析工具，它可以监测CPU、磁盘、网络等系统资源的使用情况。</p>
<ul>
<li><p>输出信息含义：</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rrqm/s：    每秒合并读操作的次数</span><br><span class="line">wrqm/s：    每秒合并写操作的次数</span><br><span class="line">r/s：       每秒读操作的次数 （IOPS）</span><br><span class="line">w/s：       每秒写操作的次数 （IOPS）</span><br><span class="line">rMB/s：     每秒读带宽</span><br><span class="line">wMB/s：     每秒写带宽</span><br><span class="line">avgrq-sz：  I/O请求的平均大小（扇区数）</span><br><span class="line">avgqu-sz：  I/O请求队列的平均长度</span><br><span class="line">await：     每个I/O平均耗时，单位是ms，这个时间包括I/O在队列中等待耗时，以及最终被磁盘设备处理的时间</span><br><span class="line">r_await：   每个读操作的平均耗时</span><br><span class="line">w_await：   每个写操作的平均耗时</span><br><span class="line">%util：     该磁盘设备的繁忙度，该设备有I/O（即非空闲）的时间比率，不考虑I/O有多少，只考虑有没有。</span><br></pre></td></tr></table></figure>
</li>
<li><p>iostat常见选项：</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-c 表示显示cpu使用情况，默认不写也会显示cpu使用情况</span><br><span class="line">-d 表示显示磁盘使用情况，默认不写也会显示disk使用情况</span><br><span class="line">-h  友好显示</span><br><span class="line">-x 表示显示额外的统计信息</span><br><span class="line">-k 表示以kb为单位显示磁盘请求数</span><br><span class="line">-m 表示以M为单位显示磁盘请求数</span><br><span class="line">-V 显示版本信</span><br><span class="line">-p  [磁盘] 显示磁盘和分区的情况</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p><code>netstat</code> 是一个用于显示网络连接、路由表、网络接口状态等网络相关信息的命令行工具。它可用于查看当前系统的网络状态、连接情况以及网络性能信息。</p>
<ul>
<li><p>常见选项以及含义</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-a (all)显示所有选项，默认不显示LISTEN相关</span><br><span class="line">-t (tcp)仅显示tcp相关选项</span><br><span class="line">-u (udp)仅显示udp相关选项</span><br><span class="line">-n 拒绝显示别名，能显示数字的全部转化成数字。</span><br><span class="line">-l 仅列出有在 Listen (监听) 的服務状态</span><br><span class="line">-p 显示建立相关链接的程序名</span><br><span class="line">-r 显示路由信息，路由表</span><br><span class="line">-e 显示扩展信息，例如uid等</span><br><span class="line">-s 按各个协议进行统计</span><br><span class="line">-c 每隔一个固定时间，执行该netstat命令。</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>Linux ps （英文全拼：process status）命令用于显示当前进程的状态，类似于 windows 的任务管理器。</p>
<ul>
<li><p>ps命令常用选项</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-A 列出所有的进程</span><br><span class="line">-w 显示加宽可以显示较多的资讯</span><br><span class="line">-au 显示较详细的资讯</span><br><span class="line">-aux 显示所有包含其他使用者的进程</span><br></pre></td></tr></table></figure>
</li>
<li><p>ps命令输出字段含义</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">USER: 行程拥有者</span><br><span class="line">PID: pid</span><br><span class="line">%CPU: 占用的 CPU 使用率</span><br><span class="line">%MEM: 占用的记忆体使用率</span><br><span class="line">VSZ: 占用的虚拟记忆体大小</span><br><span class="line">RSS: 占用的记忆体大小</span><br><span class="line">TTY: 终端的次要装置号码 (minor device number of tty)</span><br><span class="line">STAT: 该行程的状态:</span><br><span class="line"></span><br><span class="line">D: 无法中断的休眠状态 (通常 IO 的进程)</span><br><span class="line">R: 正在执行中</span><br><span class="line">S: 静止状态</span><br><span class="line">T: 暂停执行</span><br><span class="line">Z: 不存在但暂时无法消除</span><br><span class="line">W: 没有足够的记忆体分页可分配</span><br><span class="line">&lt;: 高优先序的行程</span><br><span class="line">N: 低优先序的行程</span><br><span class="line">L: 有记忆体分页分配并锁在记忆体内 (实时系统或捱A I/O)</span><br><span class="line">START: 行程开始时间</span><br><span class="line">TIME: 执行的时间</span><br><span class="line">COMMAND:所执行的指令</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Shell基础回顾"><a href="#Shell基础回顾" class="headerlink" title="Shell基础回顾"></a>Shell基础回顾</h2><h3 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h3><ul>
<li>引用用户变量和环境变量</li>
<li>命令替换</li>
<li>从键盘读入赋值</li>
</ul>
<h3 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> 函数名 &#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">函数名() &#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="if条件测试"><a href="#if条件测试" class="headerlink" title="if条件测试"></a>if条件测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>condition可以判断三种条件：</p>
<ol>
<li><p>文件比较</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-43-25.png" alt="3.Shell条件测试-2023-06-16-20-43-25"></p>
</li>
<li><p>字符串比较</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-46-41.png" alt="3.Shell条件测试-2023-06-16-20-46-41"></p>
</li>
<li><p>数值比较</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-21-06-44.png" alt="3.Shell条件测试-2023-06-16-21-06-44"></p>
</li>
</ol>
<ul>
<li><p>if多条件测试：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (( a &gt; b )) &amp;&amp; (( a &lt; c )) </span><br><span class="line">或者</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$a</span> &gt; <span class="variable">$b</span> ]] &amp;&amp; [[ <span class="variable">$a</span> &lt; <span class="variable">$c</span> ]] </span><br><span class="line">或者 </span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -gt <span class="variable">$b</span> -a <span class="variable">$a</span> -lt <span class="variable">$c</span> ]</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [ 条件 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>条件</code>是一个可以执行的测试命令或表达式，如果返回值为0，则为真，循环继续执行；否则为假，循环结束。</p>
<p>例如，下面的代码中，<code>while</code> 循环会一直执行，直到变量 <code>i</code> 的值达到 5：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前变量的值是 <span class="variable">$i</span>&quot;</span></span><br><span class="line">    i=$(( <span class="variable">$i</span> + <span class="number">1</span> ))</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 变量名 <span class="keyword">in</span> 列表</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="Shell脚本其他用法"><a href="#Shell脚本其他用法" class="headerlink" title="Shell脚本其他用法"></a>Shell脚本其他用法</h3><h3 id="select-in"><a href="#select-in" class="headerlink" title="select in"></a>select in</h3><p>select in 循环用来增强交互性，它可以显示出带编号的菜单，用户输入不同的编号就可以选择不同的菜单，并执行不同的功能。</p>
<p>Shell select in 循环的用法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> variable <span class="keyword">in</span> value_list</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    statements</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>实例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;What is your favourite OS?&quot;</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">in</span> <span class="string">&quot;Linux&quot;</span> <span class="string">&quot;Windows&quot;</span> <span class="string">&quot;Mac OS&quot;</span> <span class="string">&quot;UNIX&quot;</span> <span class="string">&quot;Android&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;You have selected <span class="variable">$name</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>select in 通常和  <code>case in</code> 一起使用，在用户输入不同的编号时可以做出不同的反应。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;What is your favourite OS?&quot;</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">in</span> <span class="string">&quot;Linux&quot;</span> <span class="string">&quot;Windows&quot;</span> <span class="string">&quot;Mac OS&quot;</span> <span class="string">&quot;UNIX&quot;</span> <span class="string">&quot;Android&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$name</span> <span class="keyword">in</span></span><br><span class="line">        <span class="string">&quot;Linux&quot;</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Linux是一个类UNIX操作系统，它开源免费，运行在各种服务器设备和嵌入式设备。&quot;</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;Windows&quot;</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Windows是微软开发的个人电脑操作系统，它是闭源收费的。&quot;</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;Mac OS&quot;</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Mac OS是苹果公司基于UNIX开发的一款图形界面操作系统，只能运行与苹果提供的硬件之上。&quot;</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;UNIX&quot;</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;UNIX是操作系统的开山鼻祖，现在已经逐渐退出历史舞台，只应用在特殊场合。&quot;</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        <span class="string">&quot;Android&quot;</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Android是由Google开发的手机操作系统，目前已经占据了70%的市场份额。&quot;</span></span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;输入错误，请重新输入&quot;</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="echo-e"><a href="#echo-e" class="headerlink" title="echo -e"></a>echo -e</h3><p>在 shell 脚本中，可以使用 <code>echo</code> 命令输出信息，但是默认情况下输出的文本是单色的，可能不够直观。如果要在输出中使用颜色，可以使用 <code>echo -e</code> 命令。</p>
<p><code>echo -e</code> 可以解析特定的转义序列，其中包括用于设置文本颜色的序列。常用的文本颜色序列如下：</p>
<ul>
<li><code>\033[0m</code>：重置所有属性，包括颜色。</li>
<li><code>\033[30m</code> - <code>\033[37m</code>：设置前景色为黑色到白色。</li>
<li><code>\033[40m</code> - <code>\033[47m</code>：设置背景色为黑色到白色。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31mThis is red text\033[0m&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="和-区别"><a href="#和-区别" class="headerlink" title="$和${}区别"></a>$和${}区别</h3><p><code>$</code> 符号后跟变量名，表示对变量进行简单的替换。例如，<code>$var</code> 表示将变量 <code>var</code> 的值替换到命令中或输出中。这种形式适用于大多数简单的变量替换场景。</p>
<p><code>$&#123;&#125;</code> 是一种更加复杂的语法形式，它可以用于更精确地定义变量扩展的边界。<code>$&#123;&#125;</code> 可以用于以下情况：</p>
<ol>
<li>明确指定变量的边界：<code>$&#123;var&#125;</code> 表示变量 <code>var</code> 的边界，可用于区分变量名与紧随其后的字符。这在与其他字符连接时特别有用，例如<code>$&#123;var&#125;name</code>。</li>
<li>执行变量替换时，<code>$&#123;&#125;</code> 可以使用更复杂的表达式，例如变量的默认值、字符串替换、命令替换等。示例：<code>$&#123;var:-default&#125;</code>、<code>$&#123;var/foo/bar&#125;</code>、<code>$&#123;var//pattern/replacement&#125;</code>。</li>
</ol>
<p>下面是一些<code>$&#123;&#125;</code>的用法示例：</p>
<ul>
<li>变量替换：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$&#123;name&#125;</span>!&quot;</span>  <span class="comment"># 输出：Hello, Alice!</span></span><br></pre></td></tr></table></figure>

<ul>
<li>指定变量边界：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text=<span class="string">&quot;Hello,&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;text&#125;</span>world&quot;</span>  <span class="comment"># 输出：Hello, !</span></span><br></pre></td></tr></table></figure>

<ul>
<li>默认值设定：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$&#123;name:-Guest&#125;</span>!&quot;</span>  <span class="comment"># 输出：Hello, Guest!</span></span><br></pre></td></tr></table></figure>

<ul>
<li>字符串替换：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text=<span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;text/world/Universe&#125;</span>&quot;</span>  <span class="comment"># 输出：Hello, Universe!</span></span><br></pre></td></tr></table></figure>

<p><code>$&#123;&#125;</code> 可以根据需要组合和嵌套，用于更复杂的变量操作和替换。它提供了更大的灵活性和精确性，使变量扩展更加强大。</p>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>Linux sort 命令用于将文本文件内容加以排序。</p>
<p>sort 可针对文本文件的内容，以行为单位来排序。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-b 忽略每行前面开始出的空格字符。</span><br><span class="line">-c 检查文件是否已经按照顺序排序。</span><br><span class="line">-d 排序时，处理英文字母、数字及空格字符外，忽略其他的字符。</span><br><span class="line">-f 排序时，将小写字母视为大写字母。</span><br><span class="line">-i 排序时，除了040至176之间的ASCII字符外，忽略其他的字符。</span><br><span class="line">-m 将几个排序好的文件进行合并。</span><br><span class="line">-M 将前面3个字母依照月份的缩写进行排序。</span><br><span class="line">-n 依照数值的大小排序。</span><br><span class="line">-u 意味着是唯一的(unique)，输出的结果是去完重了的。</span><br><span class="line">-o&lt;输出文件&gt; 将排序后的结果存入指定的文件。</span><br><span class="line">-r 以相反的顺序来排序。</span><br><span class="line">-t&lt;分隔字符&gt; 指定排序时所用的栏位分隔字符。</span><br><span class="line">+&lt;起始栏位&gt;-&lt;结束栏位&gt; 以指定的栏位来排序，范围由起始栏位到结束栏位的前一栏位。</span><br><span class="line">--help 显示帮助。</span><br><span class="line">--version 显示版本信息。</span><br><span class="line">[-k field1[,field2]] 按指定的列进行排序。</span><br></pre></td></tr></table></figure>

<ul>
<li><p>用法举例</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##原始文件</span></span><br><span class="line">$ <span class="built_in">cat</span> testfile      <span class="comment"># testfile文件原有排序  </span></span><br><span class="line"><span class="built_in">test</span> 30  </span><br><span class="line">Hello 95  </span><br><span class="line">Linux 85</span><br></pre></td></tr></table></figure>

<p>  使用sort默认的排序方式</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sort</span> testfile <span class="comment"># 重排结果  </span></span><br><span class="line">Hello 95  </span><br><span class="line">Linux 85  </span><br><span class="line"><span class="built_in">test</span> 30</span><br></pre></td></tr></table></figure>

<p>  使用 -k 参数设置对第二列的值进行重排，结果如下：</p>
  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sort</span> testfile -k 2</span><br><span class="line"><span class="built_in">test</span> 30  </span><br><span class="line">Linux 85 </span><br><span class="line">Hello 95</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="awk工具扩展"><a href="#awk工具扩展" class="headerlink" title="awk工具扩展"></a>awk工具扩展</h2><h3 id="awk内的for循环"><a href="#awk内的for循环" class="headerlink" title="awk内的for循环"></a>awk内的for循环</h3><p>在Awk中，for循环用于迭代执行一系列的操作。Awk中的for循环有两种形式：基于条件的for循环和基于集合的for循环。</p>
<ol>
<li><p>基于条件的for循环：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (初始化; 条件; 迭代) &#123;</span><br><span class="line">    <span class="comment"># 循环体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 初始化在循环开始前执行，条件在每次迭代前进行检查，如果条件为真，则执行循环体，迭代在每次循环体执行完后执行。</p>
</li>
<li><p>基于集合的for循环：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (变量 <span class="keyword">in</span> 集合) &#123;</span><br><span class="line">    <span class="comment"># 循环体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>在awk中，数组是一种常用的数据结构，用于存储和操作数据。</p>
<ol>
<li>声明数组：使用<code>arrayName[index] = value</code>语法来声明数组，并将指定的索引位置赋值为对应的值。例如：<code>fruits[0] = &quot;apple&quot;</code>。</li>
<li>访问数组元素：使用<code>arrayName[index]</code>语法来访问数组的特定元素。例如：<code>fruits[0]</code>表示访问数组<code>fruits</code>中索引为0的元素。</li>
<li>遍历数组：可以使用<code>for (index in arrayName)</code>语法来遍历数组中的所有元素。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F: <span class="string">&#x27;&#123;shells[$NF]++&#125; END&#123;for (i in shells)&#123;print i,shells[i]&#125;&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>

<h2 id="第一节课代码"><a href="#第一节课代码" class="headerlink" title="第一节课代码"></a>第一节课代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="title">os_check</span></span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> [ -e /etc/redhat-release ]; <span class="keyword">then</span></span><br><span class="line">                REDHAT=`<span class="built_in">cat</span> /etc/redhat-release |<span class="built_in">cut</span> -d<span class="string">&#x27; &#x27;</span> -f1`</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                DEBIAN=`<span class="built_in">cat</span> /etc/issue |<span class="built_in">cut</span> -d<span class="string">&#x27; &#x27;</span> -f1`</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$REDHAT</span>&quot;</span> == <span class="string">&quot;CentOS&quot;</span> -o <span class="string">&quot;<span class="variable">$REDHAT</span>&quot;</span> == <span class="string">&quot;Red&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                P_M=yum</span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$DEBIAN</span>&quot;</span> == <span class="string">&quot;Ubuntu&quot;</span> -o <span class="string">&quot;<span class="variable">$DEBIAN</span>&quot;</span> == <span class="string">&quot;ubutnu&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">                P_M=apt-get</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span><span class="string">&quot;Operating system does not support.&quot;</span></span><br><span class="line">                <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#查看登录的用户是否为 root</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$LOGNAME</span> != root ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Please use the root account operation.&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#查看是否存在 vmstat 命令</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">which</span> vmstat &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;vmstat command not found, now the install.&quot;</span></span><br><span class="line">        <span class="built_in">sleep</span> 1</span><br><span class="line">        os_check</span><br><span class="line">        <span class="variable">$P_M</span> install procps -y</span><br><span class="line">        <span class="built_in">echo</span>    <span class="string">&quot;-----------------------------------------------------------------</span></span><br><span class="line"><span class="string">        ------&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#查看是否有 iostat 命令</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">which</span> iostat &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;iostat command not found, now the install.&quot;</span></span><br><span class="line">        <span class="built_in">sleep</span> 1</span><br><span class="line">        os_check</span><br><span class="line">        <span class="variable">$P_M</span> install sysstat -y</span><br><span class="line">        <span class="built_in">echo</span>   <span class="string">&quot;------------------------------------------------------------------</span></span><br><span class="line"><span class="string">        -----&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#打印菜单</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">select</span> input <span class="keyword">in</span> cpu_load disk_load disk_use disk_inode mem_use tcp_status cpu_top10 mem_top10 traffic quit; <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">case</span> <span class="variable">$input</span> <span class="keyword">in</span></span><br><span class="line">                        cpu_load)</span><br><span class="line">                                <span class="comment">#CPU 利用率与负载</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;-----------------------------------------------------&quot;</span></span><br><span class="line">                                i=1</span><br><span class="line">                                <span class="keyword">while</span> [[ <span class="variable">$i</span> -le 3 ]]; <span class="keyword">do</span></span><br><span class="line">                                        <span class="built_in">echo</span> -e <span class="string">&quot;\033[32m 参考值<span class="variable">$&#123;i&#125;</span>\033[0m&quot;</span></span><br><span class="line">                                        UTIL=`vmstat |awk <span class="string">&#x27;&#123;if(NR==3)print 100-$15&quot;%&quot;&#125;&#x27;</span>`</span><br><span class="line">                                        USER=`vmstat |awk <span class="string">&#x27;&#123;if(NR==3)print $13&quot;%&quot;&#125;&#x27;</span>`</span><br><span class="line">                                        SYS=`vmstat |awk <span class="string">&#x27;&#123;if(NR==3)print $14&quot;%&quot;&#125;&#x27;</span>`</span><br><span class="line">                                        IOWAIT=`vmstat |awk <span class="string">&#x27;&#123;if(NR==3)print $16&quot;%&quot;&#125;&#x27;</span>`</span><br><span class="line">                                        <span class="built_in">echo</span> <span class="string">&quot;Util: <span class="variable">$UTIL</span>&quot;</span></span><br><span class="line">                                        <span class="built_in">echo</span> <span class="string">&quot;User use: <span class="variable">$USER</span>&quot;</span></span><br><span class="line">                                        <span class="built_in">echo</span> <span class="string">&quot;System use: <span class="variable">$SYS</span>&quot;</span></span><br><span class="line">                                        <span class="built_in">echo</span> <span class="string">&quot;I/O wait: <span class="variable">$IOWAIT</span>&quot;</span> </span><br><span class="line">                                        i=$((<span class="variable">$i</span>+<span class="number">1</span>))</span><br><span class="line">                                        <span class="built_in">sleep</span> 1</span><br><span class="line">                                <span class="keyword">done</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;  -------------------------------------------------------&quot;</span></span><br><span class="line">                                <span class="built_in">break</span></span><br><span class="line">                                ;;</span><br><span class="line">                        quit)</span><br><span class="line">                                <span class="built_in">exit</span> 0</span><br><span class="line">                                ;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><img src="/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0%EF%BC%9A%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA%206d8f907f7fcd4f8cbc2902b0174915eb/Untitled%203.png" alt="Untitled"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/09/c_program/1.%E7%AC%AC%E4%B8%80%E5%91%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/09/c_program/1.%E7%AC%AC%E4%B8%80%E5%91%A8/" class="post-title-link" itemprop="url">第一周</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-06-09 11:31:25" itemprop="dateCreated datePublished" datetime="2023-06-09T11:31:25+08:00">2023-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-10 16:09:30" itemprop="dateModified" datetime="2023-06-10T16:09:30+08:00">2023-06-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><ol>
<li><p>高级语言、低级语言、机器语言</p>
<ol>
<li>高级语言（High-Level Language）：<br> 高级语言是一种相对抽象和易于理解的编程语言，其目的是提供更高层次的抽象和功能，使程序员能够更容易地编写复杂的程序。高级语言使用人类可读的语法和结构，使用更高级别的概念和抽象，使得程序的编写更容易、更快速。高级语言通常需要通过编译或解释器转换为机器语言才能在计算机上执行。常见的高级语言包括C、C++、Java、Python和JavaScript等。</li>
<li>低级语言（Low-Level Language）：<br> 低级语言是与计算机硬件更接近的编程语言，它使用更接近机器语言的语法和结构。低级语言通常直接操作计算机的底层硬件和资源，提供了对硬件细节的更多控制。低级语言可以更高效地利用计算机的资源，但编写和理解低级语言程序相对更困难。汇编语言和机器语言都属于低级语言。</li>
<li>机器语言（Machine Language）：<br> 机器语言是计算机硬件直接能理解和执行的语言。它由二进制位组成，表示计算机指令和数据。机器语言是计算机可以直接执行的最底层的语言。每个计算机的机器语言是特定于该计算机体系结构的。编写机器语言程序需要对机器指令和二进制表示有深入的了解。由于机器语言的复杂性和难以理解，通常使用高级语言来编写程序，然后通过编译器或解释器将其转换为机器语言。</li>
</ol>
</li>
<li><p>解释型语言和编译型语</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.%E7%AC%AC%E4%B8%80%E5%91%A8-2023-06-09-10-53-51.png" alt="1.第一周-2023-06-09-10-53-51"></p>
<p> Python 如此设计的原因在于将程序的执行与底层硬件进一步地分离，无需担心程序的编译、汇编以及链接过程，使得 Python 程序相较于 C 程序而言更加易于移植。</p>
</li>
<li><p>C语言源代码到可执行文件的过程</p>
<ol>
<li>C源代码：<br> 程序员使用C语言编写源代码，源代码以**<code>.c</code>**为扩展名。源代码包含了程序的逻辑和功能的定义。</li>
<li>预处理：<br> 在编译之前，C预处理器会处理源代码。预处理器执行宏展开、条件编译等操作，生成经过预处理的源代码。</li>
<li>编译：<br> 经过预处理的源代码会被编译器翻译成汇编代码。编译器将C源代码转换为汇编语言表示，生成汇编代码文件（**<code>.s</code>**文件）。</li>
<li>汇编：<br> 汇编器将汇编代码转换为机器码指令。它将汇编代码文件翻译成机器可执行的指令，并生成目标文件（**<code>.o</code>**文件）。</li>
<li>链接：<br> 链接器将目标文件与其他必要的库文件进行链接，生成最终的可执行文件。链接器解析目标文件中的符号引用，并将其与库函数和其他目标文件中的符号定义进行关联。链接器生成一个包含所有必要信息的可执行文件。</li>
<li>可执行文件：<br> 最终的可执行文件是操作系统可以直接执行的二进制文件。它包含了程序的机器码指令、数据和其他必要的信息。可执行文件可以通过命令行或操作系统的运行环境来执行。</li>
</ol>
</li>
<li><p>静态语言和动态语言</p>
<ol>
<li><p>静态语言（Static Language）：<br> 静态语言是在编译时进行类型检查的语言。在静态语言中，变量的类型在编译时确定，并且编译器会对类型进行检查。在编译过程中，变量的类型和使用方法需要在代码中明确声明和定义。静态语言的编译器会检查变量的类型是否与其使用方式相匹配，以避免类型错误。常见的静态语言包括C、C++、Java等。</p>
<p> 优点：</p>
<ol>
<li>更早地发现类型错误，提前检测潜在的编程错误。</li>
<li>在编译时进行类型检查，提高代码的稳定性和可靠性。</li>
<li>性能较好，由于类型已经确定，编译器可以进行更多的优化。</li>
</ol>
<p> 缺点：</p>
<ol>
<li>代码相对冗长，需要显式声明和定义类型。</li>
<li>编译时间较长，需要进行较多的类型检查和编译过程。</li>
</ol>
</li>
<li><p>动态语言（Dynamic Language）：<br> 动态语言是在运行时进行类型检查的语言。在动态语言中，变量的类型可以根据其赋值进行推断，并且可以在运行时动态地改变变量的类型。动态语言的编译器或解释器在运行时进行类型检查和解析。常见的动态语言包括Python、JavaScript、Ruby等。</p>
<p> 优点：</p>
<ol>
<li>灵活性高，可以在运行时动态地改变变量的类型和行为。</li>
<li>代码相对简洁，无需显式声明和定义类型，灵活性提高了开发效率。</li>
</ol>
<p> 缺点：</p>
<ol>
<li>需要在运行时进行类型检查和解析，性能可能相对较低。</li>
<li>容易出现运行时类型错误，只能在运行时才能发现。</li>
</ol>
</li>
</ol>
<p> 需要注意的是，静态语言和动态语言并非绝对的对立关系，很多语言在某些方面可以具备静态语言和动态语言的特性。例如，Java是静态语言，但具备一些动态语言的特性，如反射和动态代理。同样，Python是动态语言，但也可以通过类型注解等方式实现静态类型检查。</p>
</li>
</ol>
<h2 id="C语言开发环境"><a href="#C语言开发环境" class="headerlink" title="C语言开发环境"></a>C语言开发环境</h2><ol>
<li><p>在线运行平台（一键运行）：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.nhooo.com/tool/c/">https://www.nhooo.com/tool/c/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bejson.com/runcode/c740/">https://www.bejson.com/runcode/c740/</a></li>
</ol>
</li>
<li><p>IDE（集成开发环境）：</p>
<ol>
<li><p>Visual Studio（一站式安装，一键编译运行）</p>
<p> <a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/zh-hans/">Visual Studio下载地址</a>，<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/71110525">中文安装教程</a></p>
</li>
<li><p>VSCode + mingw（配置灵活且繁琐，一键编译运行）</p>
<p> <a target="_blank" rel="noopener" href="https://code.visualstudio.com/download">VSCode下载地址，</a><a target="_blank" rel="noopener" href="https://github.com/msys2/msys2-installer/releases/download/2023-05-26/msys2-x86_64-20230526.exe">mingw下载地址</a>，<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/354400717">使用教程</a></p>
</li>
</ol>
</li>
<li><p>Linux环境（vim+gcc）</p>
<p> 编译命令<code>gcc -o 目标文件名 源文件</code></p>
<p> 例：<code>gcc -o test test.c</code> 将名为<code>test.c</code>的源文件编译成名为<code>test</code>的目标文件</p>
</li>
</ol>
<h2 id="C语言程序的结构"><a href="#C语言程序的结构" class="headerlink" title="C语言程序的结构"></a>C语言程序的结构</h2><ul>
<li><p>简单的C程序实例</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 定义一个名为num的变量 */</span></span><br><span class="line">    <span class="type">int</span> num;</span><br><span class="line">    <span class="comment">/* 为num赋一个值 */</span></span><br><span class="line">    num = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 使用printf()函数 */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I am a simple &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;computer.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;My favorite number is %d because it is first.\n&quot;</span>, num);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol>
<li><p><code>#include</code>指令和头文件</p>
<p> <code>#include</code>这行代码是一条C预处理器指令。通常，C编译器在编译前会对源代码做一些准备工作，即预处理。</p>
<p> <code>#include &lt;stdio.h&gt;</code>的作用相当于把<code>stdio.h</code>文件中的所有内容都输入该行所在的位置。实际上，这是一种“拷贝-粘贴”的操作。</p>
</li>
<li><p><code>main()</code>函数</p>
<p> C程序从<code>main()</code>函数开始执行。除了<code>main()</code>函数，你可以任意命名其他函数，而且main()函数必须是开始的函数。<code>int</code>是main()函数的返回类型。这表明main()函数返回的值是整数。返回到哪里？返回给操作系统通常，函数名后面的圆括号中包含一些传入函数的信息。该例中没有传递任何信息。因此，圆括号内是单词<code>void</code> 。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误的main函数定义1</span></span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"><span class="comment">//错误的main函数定义2</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确的main函数定义1</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//正确的main函数定义2</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br></pre></td></tr></table></figure>

<p> <strong><code>int main(int argc, char *argv[])</code></strong> 是C语言中常见的**<code>main</code>**函数的定义方式，它用于接收命令行参数。</p>
<p> 参数解释：</p>
<ul>
<li>**<code>int argc</code>**：表示命令行参数的数量（Argument Count）。</li>
<li>**<code>char *argv[]</code>**：表示命令行参数的数组（Argument Vector），是一个指针数组，每个指针指向一个以null结尾的字符串，即命令行参数的值。</li>
</ul>
<p> 使用这种方式定义的**<code>main</code>**函数可以接收命令行传递的参数，如下所示：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;argc: %d\n&quot;</span>, argc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;argv[%d]: %s\n&quot;</span>, i, argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 运行该程序并传递参数，例如：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./program arg1 arg2 arg3</span><br></pre></td></tr></table></figure>

<p> 程序运行结果会输出命令行参数的数量以及每个参数的值，如：</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">argc: 4</span><br><span class="line">argv[0]: ./program</span><br><span class="line">argv[1]: arg1</span><br><span class="line">argv[2]: arg2</span><br><span class="line">argv[3]: arg3</span><br></pre></td></tr></table></figure>
</li>
<li><p>注释</p>
<p> 在程序中，被两个<code>/* */</code>符号括起来的部分是程序的注释。写注释能让他人（包括自己）更容易明白你所写的程序。C 语言注释的好处之一是，可将注释放在任意的地方，甚至是与要解释的内容在同一行。较长的注释可单独放一行或多行。所有的注释都会被编译器忽略。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 这是一条C注释。 */</span></span><br><span class="line"><span class="comment">/* 这也是一条注释，</span></span><br><span class="line"><span class="comment">被分成两行。*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">也可以这样写注释。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* 这条注释无效，因为缺少了结束标记。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// 这种注释只能写成一行</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>花括号、函数体和块</p>
<p> 花括号把main()函数括起来。一般而言，所有的C函数都使用<code>花括号</code>标记<code>函数体的开始和结束</code>。这是规定，不能省略。只有花括号（{}）能起这种作用，圆括号（()）和方括号（[]）都不行。花括号还可用于把函数中的多条语句<code>合并</code>为一个<code>单元或块</code>。</p>
</li>
<li><p>声明（declaration）</p>
<p> 声明是C语言最重要的特性之一。在该例中，声明完成了两件事。其一，在函数中有一个名为<br> num的变量（<code>variable</code>）。其二，<code>int</code>表明<code>num</code>是一个<code>整数</code>（即，没有小数点或小数部分的数）。<code>int</code>是一种数据类型。编译器使用这些信息为<code>num</code>变量在内存中分配存储空间。</p>
</li>
<li><p>赋值</p>
<p> 赋值是C语言的基本操作之一。该行代码的意思是“把值1赋给变量num”。在执行int num;声明时，编译器在计算机内存中为变量num预留了空间，然后在执行这行赋值表达式语句时，把值储存在之前预留的位置。可以给num赋不同的值，这就是num之所以被称为变量（variable）的原因。</p>
</li>
<li><p><code>printf()</code>函数</p>
<p> 示例代码中有3行代码都使用了C语言的一个标准函数：<code>printf()</code>。圆括号表明printf是一个函数名。圆括号中的内容是从main()函数传递给printf()函数的信息。例如，上面的第1行把<code>I am a simple</code>传递给printf()函数。该信息被称为参数。</p>
<p> 换行符是一个转义序列（escape sequence）。转义序列用于代表难以表示或无法输入的字符。如，\t代表Tab键，\b代表Backspace键（退格键）。每个转义序列都以反斜杠字符（\）开始</p>
</li>
<li><p><code>return</code>语句</p>
<p> return语句是示例程序中的最后一条语句。<code>int main(void)</code>中的int表明main()函数应返回一个<code>整数</code>。C标准要求main()这样做。有返回值的C函数要有return语句。该语句以return关键字开始，后面是待返回的值，并以分号结尾。如果遗漏 main()函数中的 return 语句，程序在运行至最外面的右花括号（}）时会返回0。因此，可以省略main()函数末尾的return语句。但是，不要在其他有返回值的函数中漏掉它。</p>
</li>
</ol>
<h2 id="C语言源程序的书写格式"><a href="#C语言源程序的书写格式" class="headerlink" title="C语言源程序的书写格式"></a>C语言源程序的书写格式</h2><ol>
<li><p>缩进：使用适当的缩进来表示代码块的层次结构，常见的缩进为4个空格或一个制表符（Tab）。</p>
</li>
<li><p>大括号：对于控制结构、函数等代码块，使用大括号将其括起来，以表示代码块的开始和结束。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="comment">// 代码块</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>空格：在运算符、逗号、分号等符号周围添加适当的空格，以提高代码的可读性。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sum = a + b;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注释：使用注释来解释代码的功能、目的、算法等，以增加代码的可读性和可维护性。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算两个数的和</span></span><br><span class="line"><span class="type">int</span> sum = a + b;</span><br></pre></td></tr></table></figure>
</li>
<li><p>命名规范：使用有意义的变量名、函数名和常量名，遵循命名规范，以提高代码的可读性和可维护性。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> numberOfStudents = <span class="number">10</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">printMessage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>换行：在较长的语句中，适当地进行换行，以保持代码的可读性。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">longResult = (longValue1 + longValue2 + longValue3) /</span><br><span class="line">             (longValue4 - longValue5);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="C语言数据类型"><a href="#C语言数据类型" class="headerlink" title="C语言数据类型"></a>C语言数据类型</h2><ol>
<li><p>整型（Integer）：</p>
<ul>
<li>**<code>int</code>**：表示整数类型。通常占用4个字节。</li>
<li>**<code>short</code>**：表示短整数类型。通常占用2个字节。</li>
<li>**<code>long</code>**：表示长整数类型。通常占用4个或8个字节，取决于编译器和操作系统。</li>
</ul>
<p> 示例代码：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> num1 = <span class="number">10</span>;</span><br><span class="line"><span class="type">short</span> num2 = <span class="number">20</span>;</span><br><span class="line"><span class="type">long</span> num3 = <span class="number">30L</span>;  <span class="comment">// 后缀L表示长整数类型</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>浮点型（Floating-point）：</p>
<ul>
<li>**<code>float</code>**：表示单精度浮点数类型。通常占用4个字节。</li>
<li>**<code>double</code>**：表示双精度浮点数类型。通常占用8个字节。</li>
</ul>
<p> 示例代码：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> num1 = <span class="number">3.14f</span>;  <span class="comment">// 后缀f表示单精度浮点数类型</span></span><br><span class="line"><span class="type">double</span> num2 = <span class="number">2.71828</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符型（Character）：</p>
<ul>
<li>**<code>char</code>**：表示字符类型。通常占用1个字节。</li>
</ul>
<p> 示例代码：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> ch1 = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="type">char</span> ch2 = <span class="string">&#x27;B&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>布尔型（Boolean）：</p>
<ul>
<li>**<code>bool</code><strong>：表示布尔类型，只能取</strong><code>true</code><strong>（非零值）或</strong><code>false</code>**（零值）。</li>
</ul>
<p> 示例代码：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span>  <span class="comment">// 需要包含stdbool.h头文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> flag1 = <span class="literal">true</span>;</span><br><span class="line"><span class="type">bool</span> flag2 = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="数据类型示例代码"><a href="#数据类型示例代码" class="headerlink" title="数据类型示例代码"></a>数据类型示例代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 整型示例</span></span><br><span class="line">    <span class="type">int</span> num1 = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;整数num1 = %d，整型大小: %u 字节\n&quot;</span>, num1, <span class="keyword">sizeof</span>(num1));</span><br><span class="line"></span><br><span class="line">    <span class="type">short</span> num2 = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;短整数num2 = %hd，短整数大小: %u 字节\n&quot;</span>, num2, <span class="keyword">sizeof</span>(num2));</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> num3 = <span class="number">30L</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;长整数num3 = %ld，长整数大小: %u 字节\n&quot;</span>, num3, <span class="keyword">sizeof</span>(num3));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浮点型示例</span></span><br><span class="line">    <span class="type">float</span> num4 = <span class="number">3.14f</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;单精度浮点数num4 = %f，单精度浮点数大小: %u 字节\n&quot;</span>, num4, <span class="keyword">sizeof</span>(num4));</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> num5 = <span class="number">2.71828</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;双精度浮点数num5 = %lf，双精度浮点数大小: %u 字节\n&quot;</span>, num5, <span class="keyword">sizeof</span>(num5));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符型示例</span></span><br><span class="line">    <span class="type">char</span> ch1 = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;字符ch1 = %c，字符大小: %u 字节\n&quot;</span>, ch1, <span class="keyword">sizeof</span>(ch1));</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> ch2 = <span class="number">66</span>;  <span class="comment">// ASCII码值</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;字符ch2 = %c，字符大小: %u 字节\n&quot;</span>, ch2, <span class="keyword">sizeof</span>(ch2));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 布尔型示例</span></span><br><span class="line">    <span class="type">bool</span> flag1 = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;布尔数flag1 = %d，布尔值大小: %u 字节\n&quot;</span>, flag1, <span class="keyword">sizeof</span>(flag1));</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> flag2 = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;布尔数flag2 = %d，布尔值大小: %u 字节\n&quot;</span>, flag2, <span class="keyword">sizeof</span>(flag2));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="C语言的运算符"><a href="#C语言的运算符" class="headerlink" title="C语言的运算符"></a>C语言的运算符</h2><p>C语言中有多种类型的运算符，用于执行各种算术、逻辑和位操作。以下是C语言中常见的运算符类型：</p>
<ol>
<li>算术运算符：用于执行基本的算术操作，如加法、减法、乘法、除法、取模等。<ul>
<li>**<code>+</code>**：加法运算</li>
<li><code>-</code>：减法运算</li>
<li>*：乘法运算</li>
<li>**<code>/</code>**：除法运算</li>
<li>**<code>%</code>**：取模（取余）运算</li>
</ul>
</li>
<li>关系运算符：用于比较两个值之间的关系，返回一个布尔值（1表示真，0表示假）。<ul>
<li>**<code>==</code>**：等于</li>
<li>**<code>!=</code>**：不等于</li>
<li>**<code>&lt;</code>**：小于</li>
<li>**<code>&gt;</code>**：大于</li>
<li>**<code>&lt;=</code>**：小于等于</li>
<li>**<code>&gt;=</code>**：大于等于</li>
</ul>
</li>
<li>逻辑运算符：用于执行逻辑操作，对布尔值进行组合和求反。<ul>
<li>**<code>&amp;&amp;</code>**：逻辑与（与）</li>
<li>**<code>||</code>**：逻辑或（或）</li>
<li>**<code>!</code>**：逻辑非（非）</li>
</ul>
</li>
<li>位运算符：用于对二进制数据的位进行操作。<ul>
<li>**<code>&amp;</code>**：按位与</li>
<li>**<code>|</code>**：按位或</li>
<li>**<code>^</code>**：按位异或</li>
<li>**<code>~</code>**：按位取反</li>
<li>**<code>&lt;&lt;</code>**：左移</li>
<li>**<code>&gt;&gt;</code>**：右移</li>
</ul>
</li>
<li>赋值运算符：用于给变量赋值。<ul>
<li>**<code>=</code>**：简单赋值</li>
<li>**<code>+=</code>**：加法赋值</li>
<li>**<code>=</code>**：减法赋值</li>
<li>**<code>=</code>**：乘法赋值</li>
<li>**<code>/=</code>**：除法赋值</li>
<li>**<code>%=</code>**：取模赋值</li>
<li>**<code>&lt;&lt;=</code>**：左移赋值</li>
<li>**<code>&gt;&gt;=</code>**：右移赋值</li>
<li>**<code>&amp;=</code>**：按位与赋值</li>
<li>**<code>|=</code>**：按位或赋值</li>
<li>**<code>^=</code>**：按位异或赋值</li>
</ul>
</li>
<li>自增和自减运算符：用于对变量进行递增或递减操作。<ul>
<li>**<code>++</code>**：自增</li>
<li>**<code>-</code>**：自减</li>
</ul>
</li>
<li>条件运算符：用于根据条件选择不同的值。<ul>
<li>**<code>? :</code>**：条件表达式，也称为三元运算符。</li>
</ul>
</li>
<li>其他运算符：还有一些其他类型的运算符，如指针运算符、sizeof运算符、类型转换运算符等。</li>
</ol>
<h3 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h3><p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.%E7%AC%AC%E4%B8%80%E5%91%A8-2023-06-09-11-36-00.png" alt="1.第一周-2023-06-09-11-36-00"></p>
<p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.%E7%AC%AC%E4%B8%80%E5%91%A8-2023-06-09-11-36-08.png" alt="1.第一周-2023-06-09-11-36-08"></p>
<p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.%E7%AC%AC%E4%B8%80%E5%91%A8-2023-06-09-11-36-21.png" alt="1.第一周-2023-06-09-11-36-21"></p>
<h3 id="运算符优先级示例代码"><a href="#运算符优先级示例代码" class="headerlink" title="运算符优先级示例代码"></a>运算符优先级示例代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    int a = 5, b = 3, c = 7;</span><br><span class="line">    int result1 = a + b * c;        // 5 + 3 * 7 = 26</span><br><span class="line">    int result2 = (a + b) * c;      // (5 + 3) * 7 = 56</span><br><span class="line">    int result3 = a * b / c;        // 5 * 3 / 7 = 2</span><br><span class="line">    int result4 = a * (b / c);      // 5 * (3 / 7) = 0</span><br><span class="line">    int result5 = a % b + c;        // 5 % 3 + 7 = 9</span><br><span class="line">    int result6 = a &lt;&lt; b + c;       // 5 &lt;&lt; (3 + 7) = 512</span><br><span class="line">    int result7 = (a &lt;&lt; b) + c;     // (5 &lt;&lt; 3) + 7 = 47</span><br><span class="line">    int result8 = a &lt; b &amp;&amp; b &lt; c;   // 5 &lt; 3 &amp;&amp; 3 &lt; 7 = 0 (false)</span><br><span class="line">    int result9 = a &lt; b || b &lt; c;   // 5 &lt; 3 || 3 &lt; 7 = 1 (true)</span><br><span class="line">    int result10 = a == b ? c : a;  // 5 == 3 ? 7 : 5 = 5</span><br><span class="line"></span><br><span class="line">    printf(&quot;Result 1: %d\n&quot;, result1);</span><br><span class="line">    printf(&quot;Result 2: %d\n&quot;, result2);</span><br><span class="line">    printf(&quot;Result 3: %d\n&quot;, result3);</span><br><span class="line">    printf(&quot;Result 4: %d\n&quot;, result4);</span><br><span class="line">    printf(&quot;Result 5: %d\n&quot;, result5);</span><br><span class="line">    printf(&quot;Result 6: %d\n&quot;, result6);</span><br><span class="line">    printf(&quot;Result 7: %d\n&quot;, result7);</span><br><span class="line">    printf(&quot;Result 8: %d\n&quot;, result8);</span><br><span class="line">    printf(&quot;Result 9: %d\n&quot;, result9);</span><br><span class="line">    printf(&quot;Result 10: %d\n&quot;, result10);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/23/linux_shell/10.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/23/linux_shell/10.%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7awk/" class="post-title-link" itemprop="url">文本处理工具awk</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-23 13:26:57" itemprop="dateCreated datePublished" datetime="2023-04-23T13:26:57+08:00">2023-04-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 21:29:48" itemprop="dateModified" datetime="2023-06-16T21:29:48+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="awk简介"><a href="#awk简介" class="headerlink" title="awk简介"></a>awk简介</h2><p>awk是一种用于处理文本数据的工具，可以从文本文件或者标准输入、一个或多个文件中提取和处理数据。<br>awk以逐行扫描方式处理数据，从第一行到最后一行以查找匹配某个特定模式的文本行，并且对这些文本行执行指定动作。</p>
<h2 id="awk版本"><a href="#awk版本" class="headerlink" title="awk版本"></a>awk版本</h2><p>awk有众多版本包括传统awk、新版awk、gawk等，其中gawk是GNU组织开发的版本，也是目前最流行和最广泛使用的awk版本。gawk在传统awk和nawk的基础上添加了许多新功能和改进，例如更丰富的正则表达式支持、高级的数学和字符串处理函数、用户自定义函数等。gawk通常作为<code>/bin/gawk</code>或<code>/usr/bin/gawk</code>提供，是GNU工具集中的一部分，可以在多个平台上使用。<br>不同的awk可能在语法、功能和性能方面略有不同，在使用awk时应注意选择合适的版本，根据具体需求和系统环境来决定使用哪个版本。</p>
<h2 id="awk格式"><a href="#awk格式" class="headerlink" title="awk格式"></a>awk格式</h2><p>awk基本格式如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;pattern &#123; action &#125;&#x27; file</span><br><span class="line">awk &#x27;&#123; action &#125;&#x27; file</span><br><span class="line">awk &#x27;pattern&#x27; file</span><br></pre></td></tr></table></figure>

<ul>
<li><code>pattern</code>: 可以是一个正则表达式，也可以是一个字符串或数字，用于匹配文本中的某个字段或整行</li>
<li><code>action</code>: 是在匹配到的文本上执行的操作，可以是一个或多个命令，多个命令之间用换行或分号 <code>;</code> 分隔</li>
<li><code>file</code>: 是输入文件的名称，没有<code>file</code>参数时从标准输入读取数据</li>
</ul>
<p>在awk命令中，<code>pattern</code>和<code>action</code>之间通过大括号 <code>&#123;&#125;</code> 进行分隔，<code>pattern</code>用于匹配文本行，当匹配成功时，对应的<code>action</code>将被执行。</p>
<p>awk还支持在处理数据前和处理数据后运行命令，完整格式如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN &#123;command&#125; pattern &#123; action &#125; END &#123;command&#125;&#x27; file</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10 20 30 40 50&quot;</span> | awk <span class="string">&#x27;BEGIN &#123;sum = 0; print &quot;sum:&quot;, sum&#125; &#123;sum += $1&#125; END &#123;print &quot;Sum:&quot;, sum&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note10.text-processing-tools-awk-2023-04-24-09-42-32.png" alt="10.text-processing-tools-awk-2023-04-24-09-42-32"></p>
<h2 id="从标准输入读取数据"><a href="#从标准输入读取数据" class="headerlink" title="从标准输入读取数据"></a>从标准输入读取数据</h2><h3 id="从命令行读取数据"><a href="#从命令行读取数据" class="headerlink" title="从命令行读取数据"></a>从命令行读取数据</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print &quot;Hello World&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">Hello World</span><br><span class="line">abc</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<p>以上awk命令没有指定<code>file</code>参数，awk不会直接给出运行结果，它会等待标准输入的数据，当用户输入字符后awk会执行相应的命令并产生输出。如果要终止awk程序需要使用<code>Ctrl+D</code>产生一个EOF字符，此时会返回到命令行下。</p>
<h3 id="通过管道符号从命令读取数据"><a href="#通过管道符号从命令读取数据" class="headerlink" title="通过管道符号从命令读取数据"></a>通过管道符号从命令读取数据</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ ps -aux|awk <span class="string">&#x27;/bash/&#x27;</span></span><br><span class="line">root           1  0.0  0.0  18228  3012 pts/0    Ss+  Apr22   0:00 /bin/bash</span><br><span class="line">root          11  0.0  0.0  18232  3240 pts/1    Ss   13:36   0:00 /bin/bash</span><br><span class="line">ubuntu       269  0.0  0.0  18228  3144 pts/1    S    13:39   0:00 bash</span><br></pre></td></tr></table></figure>

<p>以上awk命令通过管道符号<code>|</code>从前面一个命令的输出结果从读取数据进行处理。</p>
<h2 id="从文件中读取数据和命令"><a href="#从文件中读取数据和命令" class="headerlink" title="从文件中读取数据和命令"></a>从文件中读取数据和命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;/Alice/&#x27;</span> example.txt</span><br><span class="line">Alice,25,Female,New York</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;/Male/&#x27;</span> example.txt</span><br><span class="line">Bob,30,Male,Los Angeles</span><br><span class="line">Charlie,22,Male,Chicago</span><br><span class="line">David,35,Male,Houston</span><br></pre></td></tr></table></figure>

<p>以上awk命令指定了<code>file</code>参数，awk会从文件中以行为单位读取数据并且使用<code>pattern</code>所表示的匹配模式进行数据匹配，由于没有指定<code>action</code>参数，awk将匹配到的数据直接输出到标准输出。</p>
<p>awk和sed一样可以从文件中读取命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f script_file.awk example.txt</span><br></pre></td></tr></table></figure>

<h2 id="awk工作原理"><a href="#awk工作原理" class="headerlink" title="awk工作原理"></a>awk工作原理</h2><ol>
<li>awk对文件或者标准输入的内容一次只处理一行，将获取到的这一行数据赋给变量$0</li>
<li>这一行的内容按awk内部变量FS定义的分隔符（缺省为空格，包括制表符tab）分解成多个字段，每一个字段存储在从$1开始的变量中。</li>
</ol>
<p>以以下数据为例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Name Age Gender City</span><br><span class="line">Alice 25 Female New York</span><br><span class="line">Bob 30 Male Los Angeles</span><br><span class="line">Charlie 22 Male Chicago</span><br><span class="line">David 35 Male Houston</span><br><span class="line">Eve 28 Female Miami</span><br></pre></td></tr></table></figure>

<p>以下awk命令的运行结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span> example.txt</span><br><span class="line">Name Gender</span><br><span class="line">Alice Female</span><br><span class="line">Bob Male</span><br><span class="line">Charlie Male</span><br><span class="line">David Male</span><br><span class="line">Eve Female</span><br></pre></td></tr></table></figure>

<ol>
<li>awk首先将第一行数据存放在变量$0中进行处理。</li>
<li>将<code>$0</code>中的数据以空格为分隔符（内部变量<code>FS</code>所定义）进行分解，分别存放在从<code>$1</code>开始的内部变量中。</li>
<li>在输出结果的每一行中第一个字段是存放在<code>$1</code>中的数据，第二个字段是存放在<code>$3</code>中的数据。</li>
<li>awk命令中的逗号映射为一个内部变量-输出字段分隔符<code>OFS</code>（默认为空格）两个字段之间由空格间隔。</li>
<li>处理完一行数据后读取下一行数据到<code>$0</code>中进行处理直到所以数据处理完毕。</li>
</ol>
<h2 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h2><h3 id="print函数"><a href="#print函数" class="headerlink" title="print函数"></a>print函数</h3><p>print函数用于打印不需要特别编排格式的简单输出。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print &quot;Name:&quot; $1 &quot;Age:&quot; $2&#125;&#x27;</span> example.txt</span><br><span class="line">Name:NameAge:Age</span><br><span class="line">Name:AliceAge:25</span><br><span class="line">Name:BobAge:30</span><br><span class="line">Name:CharlieAge:22</span><br><span class="line">Name:DavidAge:35</span><br><span class="line">Name:EveAge:28</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print &quot;Name:&quot; $1, &quot;Age:&quot; $2&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Name Age:Age</span><br><span class="line">Name:Alice Age:25</span><br><span class="line">Name:Bob Age:30</span><br><span class="line">Name:Charlie Age:22</span><br><span class="line">Name:David Age:35</span><br><span class="line">Name:Eve Age:28</span><br></pre></td></tr></table></figure>

<p>逗号<code>,</code>表示内部变量<code>OFS</code>（用来表示输出字段的分隔符，默认为空格）。<br>print还支持以下转义序列：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\b：退格符（ASCII 008）</span><br><span class="line">\t：制表符（ASCII 009）</span><br><span class="line">\n：换行符（ASCII 010）</span><br><span class="line">\f：换页符（ASCII 012）</span><br><span class="line">\r：回车符（ASCII 013）</span><br></pre></td></tr></table></figure>

<p>print中使用转义序列进行数据输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print &quot;Name:&quot; $1 &quot;\tAge:&quot; $2&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Name       Age:Age</span><br><span class="line">Name:Alice      Age:25</span><br><span class="line">Name:Bob        Age:30</span><br><span class="line">Name:Charlie    Age:22</span><br><span class="line">Name:David      Age:35</span><br><span class="line">Name:Eve        Age:28</span><br></pre></td></tr></table></figure>

<h3 id="printf函数"><a href="#printf函数" class="headerlink" title="printf函数"></a>printf函数</h3><p><code>printf</code>函数能够进行更加精细的格式化输出，用法和C语言中<code>printf</code>函数的用法一样。语句中包含一个加引号的控制串，控制串中包含若干格式说明和修饰符。控制串后面跟一个逗号，之后是一列由逗号分隔的表达式。<code>printf</code>会根据控制串来编排表达式的格式。<br><code>printf</code>和<code>print</code>不同的是printf在行尾不会自动换行，如果要换行必须使用转义字符<code>\n</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;printf &quot;[Name:%-10s]\tAge:%s&quot;, $1, $2&#125;&#x27;</span> example.txt</span><br><span class="line">[Name:Name      ]       Age:Age[Name:Alice     ]        Age:25[Name:Bob       ] Age:30[Name:Charlie   ]      Age:22[Name:David     ] Age:35[Name:Eve       ] Age:28ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;printf &quot;[Name:%-10s]\tAge:%s\n&quot;, $1, $2&#125;&#x27;</span> example.txt</span><br><span class="line">[Name:Name      ]       Age:Age</span><br><span class="line">[Name:Alice     ]       Age:25</span><br><span class="line">[Name:Bob       ]       Age:30</span><br><span class="line">[Name:Charlie   ]       Age:22</span><br><span class="line">[Name:David     ]       Age:35</span><br><span class="line">[Name:Eve       ]       Age:28</span><br></pre></td></tr></table></figure>

<h2 id="记录与字段"><a href="#记录与字段" class="headerlink" title="记录与字段"></a>记录与字段</h2><h3 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h3><p>在awk中每一行数据称为一条记录，以换行符结束。</p>
<ul>
<li>记录分隔符：默认情况下，输入和输出记录的分隔符都是回车符，分别保存在内部变量<code>ORS</code>和<code>RS</code>中。</li>
<li>变量<code>$0</code>表示当前整条记录，变量NR表示当前记录的记录号，每处理一条记录，NR值加一。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print NR,$0&#125;&#x27;</span> example.txt</span><br><span class="line">1 Name Age Gender City</span><br><span class="line">2 Alice 25 Female New York</span><br><span class="line">3 Bob 30 Male Los Angeles</span><br><span class="line">4 Charlie 22 Male Chicago</span><br><span class="line">5 David 35 Male Houston</span><br><span class="line">6 Eve 28 Female Miami</span><br></pre></td></tr></table></figure>

<h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><p>每一条记录都是由称为字段的词组成，默认情况下字段之间用空白符（空格或者制表符）分隔。<code>NF</code>变量保存每个记录的字段数量。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print NF,$0&#125;&#x27;</span> example.txt</span><br><span class="line">4 Name Age Gender City</span><br><span class="line">5 Alice 25 Female New York</span><br><span class="line">5 Bob 30 Male Los Angeles</span><br><span class="line">4 Charlie 22 Male Chicago</span><br><span class="line">4 David 35 Male Houston</span><br><span class="line">4 Eve 28 Female Miami</span><br></pre></td></tr></table></figure>

<h3 id="字段分隔符"><a href="#字段分隔符" class="headerlink" title="字段分隔符"></a>字段分隔符</h3><p>字段分隔符由内部变量<code>FS</code>保存，可以在命令中通过<code>-F</code>选项修改<code>FS</code>的值。<br>先使用<code>sed</code>命令将<code>example.txt</code>文件中的空格替换为逗号：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ sed -i <span class="string">&#x27;s/ /,/g&#x27;</span> example.txt</span><br><span class="line">ubuntu@6e455ed15da7:~$ <span class="built_in">cat</span> example.txt</span><br><span class="line">Name,Age,Gender,City</span><br><span class="line">Alice,25,Female,New,York</span><br><span class="line">Bob,30,Male,Los,Angeles</span><br><span class="line">Charlie,22,Male,Chicago</span><br><span class="line">David,35,Male,Houston</span><br><span class="line">Eve,28,Female,Miami</span><br></pre></td></tr></table></figure>

<p>然后使用awk并通过<code>-F</code>选项替换分隔符进行输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;&#123;print &quot;Name:&quot; $1, &quot;Age:&quot; $2&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Name,Age,Gender,City Age:</span><br><span class="line">Name:Alice,25,Female,New,York Age:</span><br><span class="line">Name:Bob,30,Male,Los,Angeles Age:</span><br><span class="line">Name:Charlie,22,Male,Chicago Age:</span><br><span class="line">Name:David,35,Male,Houston Age:</span><br><span class="line">Name:Eve,28,Female,Miami Age:</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk -F, <span class="string">&#x27;&#123;print &quot;Name:&quot; $1, &quot;Age:&quot; $2&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Name Age:Age</span><br><span class="line">Name:Alice Age:25</span><br><span class="line">Name:Bob Age:30</span><br><span class="line">Name:Charlie Age:22</span><br><span class="line">Name:David Age:35</span><br><span class="line">Name:Eve Age:28</span><br></pre></td></tr></table></figure>

<h2 id="匹配模式与正则表达式"><a href="#匹配模式与正则表达式" class="headerlink" title="匹配模式与正则表达式"></a>匹配模式与正则表达式</h2><h3 id="匹配模式"><a href="#匹配模式" class="headerlink" title="匹配模式"></a>匹配模式</h3><p>awk中的模式可以是一个正则表达式或者用来判定条件真伪的表达式。</p>
<p>使用<code>Alice</code>进行数据匹配：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ cat example.txt</span><br><span class="line">Name Age Gender City</span><br><span class="line">Alice 25 Female New York</span><br><span class="line">Bob 30 Male Los Angeles</span><br><span class="line">Charlie 22 Male Chicago</span><br><span class="line">David 35 Male Houston</span><br><span class="line">Eve 28 Female Miami</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk &#x27;/Alice/&#x27; example.txt</span><br><span class="line">Alice 25 Female New York</span><br></pre></td></tr></table></figure>

<p>使用条件表达式进行数据匹配：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ cat example.txt</span><br><span class="line">Name Age Gender City</span><br><span class="line">Alice 25 Female New York</span><br><span class="line">Bob 30 Male Los Angeles</span><br><span class="line">Charlie 22 Male Chicago</span><br><span class="line">David 35 Male Houston</span><br><span class="line">Eve 28 Female Miami</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk &#x27;$2 &lt; 25&#x27; example.txt</span><br><span class="line">Charlie 22 Male Chicago</span><br></pre></td></tr></table></figure>

<h3 id="正则表达式模式与操作"><a href="#正则表达式模式与操作" class="headerlink" title="正则表达式模式与操作"></a>正则表达式模式与操作</h3><p>使用正则表达式模式<code>Alice</code>进行数据匹配，然后通过<code>print</code>函数进行格式化输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;/Alice/&#123;print &quot;Name:&quot; $1&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Alice</span><br><span class="line">ubuntu@6e455ed15da7:~$ <span class="built_in">cat</span> example.txt</span><br><span class="line">Name Age Gender City</span><br><span class="line">Alice 25 Female New York</span><br><span class="line">Bob 30 Male Los Angeles</span><br><span class="line">Charlie 22 Male Chicago</span><br><span class="line">David 35 Male Houston</span><br><span class="line">Eve 28 Female Miami</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;/Alice/&#123;print &quot;Name:&quot; $1&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Alice</span><br></pre></td></tr></table></figure>

<p>格式化输出<code>example.txt</code>文件中所有以大写字母<code>A-C</code>开头的行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ <span class="built_in">cat</span> example.txt</span><br><span class="line">Name Age Gender City</span><br><span class="line">Alice 25 Female New York</span><br><span class="line">Bob 30 Male Los Angeles</span><br><span class="line">Charlie 22 Male Chicago</span><br><span class="line">David 35 Male Houston</span><br><span class="line">Eve 28 Female Miami</span><br><span class="line">ubuntu@6e455ed15da7:~$ awk <span class="string">&#x27;/^[A-C]+.*/&#123;print &quot;Name:&quot; $1&#125;&#x27;</span> example.txt</span><br><span class="line">Name:Alice</span><br><span class="line">Name:Bob</span><br><span class="line">Name:Charlie</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="显示系统下各用户所使用的shell"><a href="#显示系统下各用户所使用的shell" class="headerlink" title="显示系统下各用户所使用的shell"></a>显示系统下各用户所使用的shell</h3><p>查看当前<code>/etc/passwd</code>格式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@6e455ed15da7:~$ <span class="built_in">cat</span> /etc/passwd|<span class="built_in">head</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>使用awk显示各用户使用的shell:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">User:root Shell:/bin/bash</span><br><span class="line">User:daemon Shell:/usr/sbin/nologin</span><br><span class="line">User:bin Shell:/usr/sbin/nologin</span><br><span class="line">User:sys Shell:/usr/sbin/nologin</span><br><span class="line">User:<span class="built_in">sync</span> Shell:/bin/sync</span><br><span class="line">User:games Shell:/usr/sbin/nologin</span><br><span class="line">User:man Shell:/usr/sbin/nologin</span><br><span class="line">User:lp Shell:/usr/sbin/nologin</span><br><span class="line">User:mail Shell:/usr/sbin/nologin</span><br><span class="line">User:news Shell:/usr/sbin/nologin</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Shell初始,编辑器使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 11:31:25" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:25+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 11:10:44" itemprop="dateModified" datetime="2023-06-16T11:10:44+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是Shell"><a href="#什么是Shell" class="headerlink" title="什么是Shell"></a>什么是Shell</h2><p>现在人们使用的操作系统（Windows、Android、iOS等）都带有图形界面，简单直观，容易上手。然而早期的计算机并没有图形界面，人们只能使用烦琐的命令来控制计算机。其实，真正能够控制计算机硬件（CPU、内存、显示器）的只有操作系统内核（Kernel），图形界面和命令行都是架设在用户和内核之间的桥梁，是为了方便用户控制计算机而存在的。由于安全等原因，用户不能直接接触内核，因此需要在用户和内核之间增加“命令解释器”，既能简化用户的操作，又能保障内核的安全。在Linux下的命令解释器叫作“Shell”，它能让用户更加高效、安全、低成本地使用Linux内核。  </p>
<p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-18-53-43.png" alt="1.Shell初识，编辑器使用-2023-04-19-18-53-43"></p>
<h2 id="Shell的各种版本"><a href="#Shell的各种版本" class="headerlink" title="Shell的各种版本"></a>Shell的各种版本</h2><ol>
<li>Bourne shell（sh）是Unix系统中最古老的shell，也是现在大多数shell的基础。它的命令行语法较为简单，缺乏一些高级特性，但是在大多数Unix系统中都内置了这个shell，因此可以保证可移植性。尽管Bourne shell已经被多种先进的shell所取代，但它作为shell编程的鼻祖，仍然具有重要的历史和学习价值。</li>
<li>Bourne Again Shell （bash）是Linux操作系统所使用的Shell，它是Bourne Shell的扩展，简称bash。bash与Bourne Shell完全向下兼容，也就是说bash可以兼容相同版本的Bourne Shell。bash在Bourne Shell的基础上增加、增强了很多特性，所以它比Bourne Shell能力更强。</li>
<li>zsh（Z shell）是Bourne shell（sh）的一个增强版本。与bash相比，zsh具有更好的命令补全功能、更好的主题和插件支持、更好的脚本语言、更好的历史命令管理和更好的可定制性。它还有许多其他功能，如自动提示，文件名扩展，别名扩展等。zsh是一种功能强大、易于使用和高度可定制的Shell，适用于任何需要使用命令行的用户。</li>
</ol>
<p><strong>练习</strong>：</p>
<figure class="highlight shell"><figcaption><span>查看Shell版本、更换默认Shell并生效设置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看当前Shell版本</span></span></span><br><span class="line">[centos@host1 ~]$ echo $SHELL</span><br><span class="line">/bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看系统当前可用Shell</span></span></span><br><span class="line">[centos@host1 ~]$ cat /etc/shells</span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/sh</span><br><span class="line">/usr/bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#更换默认Shell</span></span></span><br><span class="line">[centos@host1 ~]$ chsh -s /bin/sh</span><br><span class="line">Changing shell for root.</span><br><span class="line">Shell changed.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#退出当前登录状态重新登录</span></span></span><br><span class="line">[centos@host1 ~]$ logout</span><br></pre></td></tr></table></figure>

<h2 id="Shell的启动方式和提示符"><a href="#Shell的启动方式和提示符" class="headerlink" title="Shell的启动方式和提示符"></a>Shell的启动方式和提示符</h2><ol>
<li><p>终端上启动<br> Shell会以交互模式启动，提示符会显示在屏幕上，等待用户输入命令。<br> 用户输入命令后，Shell会解释和执行这些命令，并将执行结果输出到终端上。<br> 在终端启动模式下，Shell会自动设置一些环境变量，如PATH等，以便用户可以方便地执行命令。</p>
</li>
<li><p>脚本启动<br> 脚本启动是将Shell命令写入一个脚本文件中，然后通过执行这个脚本文件来启动Shell。它的基本过程如下：<br> （1）创建一个包含Shell命令的脚本文件（通常以.sh作为扩展名）。<br> （2）将脚本文件保存到磁盘上，并赋予执行权限。<br> （3）在终端中输入脚本文件的路径，并按下回车键。<br> （4）Shell会读取脚本文件中的命令，并依次执行这些命令。<br> 脚本启动模式适用于需要重复执行的一系列命令，可以将这些命令写入脚本文件中，并通过脚本文件来执行这些命令。此外，脚本启动模式还支持各种Shell的内置命令和选项。</p>
</li>
<li><p>练习修改系统提示符: <code>vim ~/.bashrc</code> 中的PS1变量</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-19-21-30.png" alt="1.Shell初识，编辑器使用-2023-04-19-19-21-30"></p>
<h2 id="Linux的文件系统和权限信息"><a href="#Linux的文件系统和权限信息" class="headerlink" title="Linux的文件系统和权限信息"></a>Linux的文件系统和权限信息</h2><ul>
<li>Linux和Windows文件目录的比较</li>
<li>Linux根目录各子目录的作用</li>
<li>遍历目录</li>
</ul>
<h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-23-41-03.png" alt="1.Shell初识，编辑器使用-2023-04-19-23-41-03"></p>
<ul>
<li><p>Linux基本文件和目录命令使用综合练习</p>
<ol>
<li>新建一个名为<code>test</code>的目录，进入该目录并新建一个名为<code>file.txt</code>的文件。</li>
<li>将<code>file.txt</code>复制到<code>test</code>目录下，并将其重命名为<code>file2.txt</code>。</li>
<li>在当前目录下，新建一个名为<code>newdir</code>的目录。</li>
<li>将<code>file2.txt</code>移动到<code>newdir</code>目录下。</li>
<li>在当前目录下，使用<code>touch</code>命令创建一个名为<code>empty.txt</code>的空文件。</li>
<li>在<code>newdir</code>目录下，使用<code>find</code>命令查找以<code>.txt</code>结尾的文件，并将结果输出到名为<code>result.txt</code>的文件中。</li>
<li>在<code>newdir</code>目录下，使用<code>chmod</code>命令将<code>file2.txt</code>的所有用户的权限设置为可读可写可执行。</li>
<li>在当前目录下，使用<code>mkdir</code>命令递归创建一个名为<code>parent/child/grandchild</code>的目录树。</li>
</ol>
<p>  答案：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">touch</span> file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line"><span class="built_in">cp</span> file.txt file2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#3</span></span><br><span class="line"><span class="built_in">mkdir</span> newdir</span><br><span class="line"></span><br><span class="line"><span class="comment">#4</span></span><br><span class="line"><span class="built_in">mv</span> file2.txt newdir/</span><br><span class="line"></span><br><span class="line"><span class="comment">#5</span></span><br><span class="line"><span class="built_in">touch</span> empty.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#6</span></span><br><span class="line"><span class="built_in">cd</span> newdir</span><br><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span> -<span class="built_in">type</span> f &gt; result.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#7</span></span><br><span class="line"><span class="built_in">chmod</span> 777 file2.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#8</span></span><br><span class="line"><span class="built_in">mkdir</span> -p parent/child/grandchild</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="VIM使用"><a href="#VIM使用" class="headerlink" title="VIM使用"></a>VIM使用</h2><ol>
<li><p>学习平台：</p>
<p> <a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/intro.html#intro.txt">VIM官方文档</a></p>
<p> <a target="_blank" rel="noopener" href="https://command-lab.com/cat-vim-ch-s/">VIM基础练习平台</a></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/MeiTianT/vim-galore-zh_cn#%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84">VIM进阶</a></p>
</li>
<li><p>vim常用命令</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-23-41-33.png" alt="1.Shell初识，编辑器使用-2023-04-19-23-41-33"></p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/2.%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/2.%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">构建基本脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 21:12:02" itemprop="dateModified" datetime="2023-06-16T21:12:02+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="构建基本脚本"><a href="#构建基本脚本" class="headerlink" title="构建基本脚本"></a>构建基本脚本</h2><ul>
<li><p>在命令行中使用分号组织命令  </p>
<p>  Shell脚本的关键在于输入多个命令并处理每个命令的结果，甚至需要将一个命令的结果传给另一个命令。Shell可以让你将多个命令串起来，一次执行完成。如果要两个命令一起运行，可以把它们放在同一行中，彼此间用分号隔开。</p>
  <figure class="highlight shell"><figcaption><span>使用分号一次执行两个命令</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 /]$ date;date</span><br><span class="line">Tue Jun 13 14:16:40 UTC 2023</span><br><span class="line">Tue Jun 13 14:16:40 UTC 2023</span><br><span class="line">[centos@host1 /]$ date;whoami</span><br><span class="line">Tue Jun 13 14:16:44 UTC 2023</span><br><span class="line">centos</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Shell脚本文件  </p>
<p>  执行<code>vim test.sh</code>命令使用<code>vim</code>创建一个名为<code>test.sh</code>的脚本文件，编辑以下内容：  </p>
  <figure class="highlight bash"><figcaption><span>第一个Shell脚本</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是一行注释，下面两行代码通过echo命令向标准输出发送指定字符</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello World!&quot;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>在Shell脚本中，井号<code>#</code>用作注释行，Shell并不会处理Shell脚本中的注释行。但是Shell脚本文件的第一行是个例外，<code>#!</code>符号是一个特殊的标记，它会告诉系统用哪个Shell来运行脚本。  </li>
<li>在Shell脚本中，你可以在独立的行中书写命令，Shell会按根据命令在文件中出现的顺序进行处理。</li>
</ol>
</li>
</ul>
<h2 id="执行脚本文件的方式"><a href="#执行脚本文件的方式" class="headerlink" title="执行脚本文件的方式"></a>执行脚本文件的方式</h2><p>在执行脚本时先查看脚本是否有执行权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ ls -l test.sh</span><br><span class="line">-rwxrwxr-x 1 centos centos 124 Jun 13 14:51 test.sh</span><br></pre></td></tr></table></figure>

<ul>
<li><p>第一种方式：在提示符中使用绝对或者相对文件路径来引用脚本文件</p>
</li>
<li><p>第二种方式：将Shell脚本文件所处目录添加到PATH变量中</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三种方式：使用 <code>bash + 脚本名</code> 或者 <code>source + 脚本名</code> 进行调用</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">Hello World!</span><br><span class="line">Hello World!</span><br><span class="line">[centos@host1 ~]$ source test.sh</span><br><span class="line">Hello World!</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Shell变量概念"><a href="#Shell变量概念" class="headerlink" title="Shell变量概念"></a>Shell变量概念</h2><ul>
<li><p>变量定义</p>
<p>  Shell变量是一种用于存储数据的容器。在Shell脚本中，变量用于存储各种类型的数据，例如数字、字符、字符串等。变量名通常是由一个字母、数字或下划线组成的字符串，并且不能以数字开头。</p>
</li>
<li><p>变量分类</p>
<p>  Shell中主要有两种类型的变量：环境变量和自定义变量。环境变量是在系统中定义的，可以由所有进程和用户访问。常见的环境变量包括PATH、HOME和USER等。自定义变量是在脚本中定义的，只能在脚本中使用，不能在脚本外部访问。</p>
</li>
<li><p>定义变量的语法格式： <code>varName=varValue</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 定义一个变量，变量名为var，变量的值为数值10</span></span><br><span class="line">var1=10</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 定义一个变量，变量名为var，变量的值为字符串&quot;Hello World&quot;</span></span><br><span class="line">var2=<span class="string">&quot;Hello World&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 使用echo命令向标准输出打印变量var1和var2的值</span></span><br><span class="line"><span class="comment"># 使用美元符号$可以在脚本中引用已经定义过的变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var1 = <span class="variable">$var1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var2 = <span class="variable">$var2</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>  使用<code>bash test.sh</code>命令运行脚本：  </p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">var1 = 10</span><br><span class="line">var2 = Hello World</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Shell环境变量"><a href="#Shell环境变量" class="headerlink" title="Shell环境变量"></a>Shell环境变量</h2><h3 id="环境变量定义"><a href="#环境变量定义" class="headerlink" title="环境变量定义"></a>环境变量定义</h3><p>Bash Shell用环境变量（environment variable）来存储有关Shell会话和工作环境的信息（这也是它们被称作环境变量的原因）。这项特性允许你在内存中存储数据，以便程序或Shell中运行的脚本能够轻松访问到它们。这也是存储持久数据的一种简便方法。  </p>
<h3 id="环境变量分类"><a href="#环境变量分类" class="headerlink" title="环境变量分类"></a>环境变量分类</h3><ol>
<li><p>局部环境变量  </p>
<p> 局部环境变量只能在定义它们的进程中可见。查看局部环境变量的列表有点复杂。在Linux系统并没有一个只显示局部环境变量的命令。set命令会显示为某个特定进程设置的所有环境变量，包括局部变量、全局变量以及用户定义变量。</p>
<ul>
<li><p>定义和使用局部变量  </p>
<p>  区别于系统环境变量使用小写字符，当字符串内有空格时需要用双引号修饰。</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">局部变量赋值时如果字符串内有空格不能直接赋值</span></span><br><span class="line">[centos@host1 test]$ my_var=Hello World</span><br><span class="line">bash: World: command not found</span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用引号修饰字符串</span></span><br><span class="line">[centos@host1 test]$ my_var=&quot;Hello World&quot;</span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure></li>
</ul>
<p> 局部变量在子Shell中不可用，同样子Shell中定义的局部变量在父Shell中不可用。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在父shell中创建局部环境变量，并查看变量的值</span></span><br><span class="line">[centos@host1 test]$ my_var=&quot;Hello World&quot;</span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line">Hello World</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用bash创建子shell，在子shell中查看变量为空</span></span><br><span class="line">[centos@host1 test]$ bash</span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>全局环境变量  </p>
<p> 全局环境变量对于Shell会话和所有生成的子Shell都是可见的。局部变量则只对创建它们的Shell可见。这让全局环境变量对那些所创建的子Shell需要获取父Shell信息的程序来说非常有用。<br> Linux系统在你开始bash会话时就设置了一些全局环境变量。系统环境变量基本上都是使用全大写字母，以区别于普通用户的环境变量。</p>
<ul>
<li><p>查看和使用全局环境变量</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 test]$ printenv HOME</span><br><span class="line">/home/centos</span><br><span class="line">[centos@host1 test]$ echo $HOME</span><br><span class="line">/home/centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用<span class="string">&#x27;$&#x27;</span>在shell中引用环境变量</span></span><br><span class="line">[centos@host1 test]$ ls $HOME</span><br><span class="line">test  test.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局环境变量可以用于所有子Shell</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在父shell中查看环境变量HOME</span></span><br><span class="line">[centos@host1 test]$ printenv HOME</span><br><span class="line">/home/centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用bash命令创建子shell</span></span><br><span class="line">[centos@host1 test]$ bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在子shell中查看HOME变量</span></span><br><span class="line">[centos@host1 test]$ printenv HOME</span><br><span class="line">/home/centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前系统的父子shell关系</span></span><br><span class="line">[centos@host1 test]$ ps -f</span><br><span class="line">UID          PID    PPID  C STIME TTY          TIME CMD</span><br><span class="line">centos       126     125  0 03:08 pts/3    00:00:00 bash</span><br><span class="line">centos       150     126  0 05:12 pts/3    00:00:00 bash</span><br><span class="line">centos       166     150  0 05:12 pts/3    00:00:00 ps -f</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置全局环境变量</p>
<p>  在设定全局环境变量的进程所创建的子进程中，该变量都是可见的。创建全局环境变量的方法是先创建一个局部环境变量，然后再使用 <code>export</code>把它导出到全局环境中。</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在父shell中创建局部变量</span></span><br><span class="line">[centos@host1 test]$ my_var=&quot;Hello World&quot;</span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line">Hello World</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将局部变量导出为全局变量</span></span><br><span class="line">[centos@host1 test]$ export my_var</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建子shell</span></span><br><span class="line">[centos@host1 test]$ bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看子shell继承的全局变量</span></span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line">Hello World</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改子shell的全局变量</span></span><br><span class="line">[centos@host1 test]$ my_var=&quot;NULL&quot;</span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line">NULL</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退回父shell</span></span><br><span class="line">[centos@host1 test]$ exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">父shell内的全局变量值没有变</span></span><br><span class="line">[centos@host1 test]$ echo $my_var</span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>
</li>
<li><p>bash默认的环境变量</p>
<ol>
<li>HOME：当前用户的家目录</li>
<li>PATH：系统执行命令的路径</li>
<li>USER：当前登录的用户名</li>
<li>Shell：当前用户使用的默认Shell程序</li>
<li>PWD：当前工作目录</li>
<li>LANG：当前语言环境</li>
<li>TERM：当前终端的类型</li>
<li>PS1：命令提示符的格式</li>
<li>HISTSIZE：命令历史记录的长度限制</li>
<li>HISTFILESIZE：命令历史记录文件的大小限制</li>
</ol>
</li>
<li><p>设置PATH环境变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看PATH变量的值</span></span><br><span class="line">[centos@host1 test]$ echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改PATH变量，追加目录/home/centos</span></span><br><span class="line">[centos@host1 test]$ PATH=$PATH:/home/centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">确认PATH变量的值</span></span><br><span class="line">[centos@host1 test]$ echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/centos</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h2><p>Shell脚本会自动决定变量值的数据类型。在脚本的整个生命周期里，Shell脚本中定义的变量会一直保持着它们的值，但在Shell脚本结束时会被删除掉。</p>
<ul>
<li><p>引用用户变量和环境变量</p>
<ul>
<li>使用等号将值赋给用户变量。在变量、等号和值之间不能出现空格。</li>
<li>在脚本的整个生命周期里，Shell脚本中定义的变量会一直保持着它们的值，但在Shell脚本结束时会被删除掉。</li>
<li>变量每次被引用时，都会输出当前赋给它的值。引用一个变量值时需要使用美元符，而引用变量来对其进行赋值时则不要使用美元符。没有美元符，Shell会将变量名解释成普通的文本字符串。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过引用环境变量进行赋值</span></span><br><span class="line">var1=<span class="variable">$HOME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过echo命令打印var1的值</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;var1 = <span class="variable">$var1</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">var1 = /home/centos</span><br></pre></td></tr></table></figure>
</li>
<li><p>命令替换</p>
<p>  Shell脚本中最有用的特性之一就是可以从命令输出中提取信息，并将其赋给变量。把输出赋给变量之后，就可以随意在脚本中使用了。这个特性在处理脚本数据时尤为方便。有两种方法可以将命令输出赋给变量：</p>
<ul>
<li>反引号字符（&#96;）(与~同键位)</li>
<li>$()格式</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过引用环境变量进行赋值</span></span><br><span class="line">today=`<span class="built_in">date</span> +%y%m%d`</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> <span class="built_in">log</span>.<span class="variable">$today</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建了一个后缀为当前系统时间的日志文件</span></span><br><span class="line">[centos@host1 ~]$ ls</span><br><span class="line">log.230616  test.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>从键盘读入赋值</p>
<p>  在Shell脚本中，Shell变量可以通过从键盘读入输入的内容并来赋值。命令格式为：<code>read –p [提示信息]：[变量名]</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用read命令打印出提示信息，等待用户输入字符并回车后将字符保存在变量ip内</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;input ip:&quot;</span> ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ping检查用户所输入的ip地址的连通性</span></span><br><span class="line">ping -c2 <span class="variable">$ip</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="变量的数值计算"><a href="#变量的数值计算" class="headerlink" title="变量的数值计算"></a>变量的数值计算</h2><ol>
<li><p>使用 <code>expr</code>命令</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">expr</span> 5 + 2</span><br><span class="line"><span class="built_in">expr</span> 5+2</span><br><span class="line"><span class="built_in">expr</span> 5 * 2</span><br><span class="line"><span class="built_in">expr</span> 5 \* 2</span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">expr</span>的用法里运算符两侧需要添加空格</span></span><br><span class="line">7</span><br><span class="line">5+2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">星号*不能直接作为乘法运算符使用，需要用反斜杠进行转义</span></span><br><span class="line">expr: syntax error</span><br><span class="line">10</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用方括号</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">var1=100</span><br><span class="line">var2=50</span><br><span class="line">var3=45</span><br><span class="line"></span><br><span class="line">var4=$[<span class="variable">$var1</span> / <span class="variable">$var2</span>]</span><br><span class="line">var5=$[<span class="variable">$var1</span> / <span class="variable">$var3</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> var4 = <span class="variable">$var4</span></span><br><span class="line"><span class="built_in">echo</span> var5 = <span class="variable">$var5</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">var4 = 2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用方括号进行的数值计算在整数范围内</span></span><br><span class="line">var5 = 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>在脚本内使用 <code>bc</code> 进行浮点数计算</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">var1=`<span class="built_in">echo</span> <span class="string">&quot;scale=4; 3.44 / 5&quot;</span> | bc`</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> the answer is <span class="variable">$var1</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">the answer is .6880</span><br></pre></td></tr></table></figure>
</li>
<li><p>let数值运算命令</p>
<p> let数值符号可以直接进行计算，且不带回显功能，也就是说当使用let的时候，不再使用$引用变量。let运算命令的语法格式为：let 赋值表达式，其功能等同于<code>((赋值表达式))</code> 。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ let sum=sum+8</span><br><span class="line">[centos@host1 ~]$ echo $sum</span><br><span class="line">8</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量的自增</p>
<p> Shell变量的自增运算符是<code>i++</code>和<code>++i</code>。<code>i++</code>表示<strong>先赋值再自加</strong>，<code>++i</code>表示<strong>先自加再赋值</strong>。</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">var1=10</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> var1++</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> ++var1</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> var2=var1++</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var2</span> <span class="variable">$var1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> var2=++var1</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var2</span> <span class="variable">$var1</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">12 13</span><br><span class="line">14 14</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="特殊参数"><a href="#特殊参数" class="headerlink" title="特殊参数"></a>特殊参数</h2><ul>
<li><p>位置参数</p>
<p>  $0表示脚本名，$1表示脚本传递的第一个参数，$2 表示传递的第二个参数。</p>
<p>  创建脚本test.sh、编辑以下内容：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> name is <span class="variable">$0</span>, var1 = <span class="variable">$1</span>, var2 = <span class="variable">$2</span></span><br></pre></td></tr></table></figure>

<p>  运行脚本：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">name is test.sh, var1 = , var2 =</span><br><span class="line">[centos@host1 ~]$ bash test.sh 123 abc</span><br><span class="line">name is test.sh, var1 = 123, var2 = abc</span><br></pre></td></tr></table></figure>
</li>
<li><p>预定义参数</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>$0</td>
<td>脚本名</td>
</tr>
<tr>
<td>$*</td>
<td>所有的参数（以整体的形式）</td>
</tr>
<tr>
<td>$@</td>
<td>所以的参数（以数组的形式）</td>
</tr>
<tr>
<td>$#</td>
<td>参数的个数</td>
</tr>
<tr>
<td>$$</td>
<td>当前进程的PID</td>
</tr>
<tr>
<td>$!</td>
<td>上一个后台进程的PID</td>
</tr>
<tr>
<td>$?</td>
<td>上一个命令的返回值 0表示成功</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="Shell中的特殊符号"><a href="#Shell中的特殊符号" class="headerlink" title="Shell中的特殊符号"></a>Shell中的特殊符号</h2><ul>
<li><p>“#”用在行首表示程序的注释。</p>
</li>
<li><p>“;” 作为命令的分隔符，分隔同一行上两个或者两个以上的命令。</p>
</li>
<li><p>“.”等价于source命令。它是bash中的一个内建命令。</p>
<p>  “.”也可以作为文件名的一部分，如果”.”放在文件名的开头，那么这个文件将会成为”隐藏文件”，ls命令将不会正常显示出这个文件。</p>
</li>
<li><p>单引号’’，双引号””的区别是单引号’’剥夺了所有字符的特殊含义，单引号’’内就变成了单纯的字符。双引号””则对于双引号””内的参数替换($)和命令替换(&#96;&#96;)是个例外。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">Shell条件测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 21:12:59" itemprop="dateModified" datetime="2023-06-16T21:12:59+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="结构化命令概念"><a href="#结构化命令概念" class="headerlink" title="结构化命令概念"></a>结构化命令概念</h2><p>Shell按照命令在脚本中出现的顺序依次进行处理。对顺序操作来说，这已经足够了，因为在这种操作环境下，你想要的就是所有的命令按照正确的顺序执行。  </p>
<p>许多程序要求对shell脚本中的命令施加一些逻辑流程控制。有一类命令会根据条件使脚本跳过某些命令。这样的命令通常称为结构化命令（structured command）  </p>
<p>常见的条件测试命令： <code>if-then语句</code> 、 <code>case语句</code> 、 <code>for语句</code> 、 <code>while语句</code></p>
<h2 id="if条件语句"><a href="#if条件语句" class="headerlink" title="if条件语句"></a>if条件语句</h2><ul>
<li><p>if条件语句通常由以下三个关键字组成：</p>
<ol>
<li>if：用于指定要测试的条件</li>
<li>then：用于指定如果条件为true时要执行的指令</li>
<li>else：用于指定如果条件为false时要执行的指令</li>
</ol>
  <figure class="highlight bash"><figcaption><span>if条件语句格式</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    command1 </span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>在其他编程语言中，if语句之后的对象是一个等式，这个等式的求值结果为TRUE或FALSE。但bash shell的if语句并不是这么做的。bash shell的if语句会运行if后面的那个命令。如果该命令的退出状态码是0（该命令成功运行），位于then部分的命令就会被执行。如果该命令的退出状态码是其他值，then部分的命令就不会被执行，bash shell会继续执行脚本中的下一个命令。fi语句用来表示if-then语句到此结束。</p>
<p>创建脚本test.sh、编辑以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试的条件为`pwd`命令，根据命令的返回值进行跳转</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">pwd</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;it worked&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>运行脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">/home/centos</span><br><span class="line">it worked</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>if-then</code> 语句的另一种形式</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">command</span>; <span class="keyword">then</span></span><br><span class="line">commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>练习</strong></p>
<p>  创建脚本test.sh、编辑以下内容：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 待测试的用户名为centos</span></span><br><span class="line">testuser=centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据grep语句的运行结果进行跳转，即文件/etc/passwd内是否有centos这个字符</span></span><br><span class="line"><span class="keyword">if</span> grep <span class="variable">$testuser</span> /etc/passwd</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="comment"># 如果找到centos字符，打印以下信息</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;it worked&quot;</span></span><br><span class="line">        <span class="comment"># 同时显示centos家目录下以.b开头的隐藏文件</span></span><br><span class="line">        <span class="built_in">ls</span> -a /home/<span class="variable">$testuser</span>/.b*</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>  运行脚本：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">centos:x:1000:1000::/home/centos:/bin/bash</span><br><span class="line">it worked</span><br><span class="line">/home/centos/.bash_history  /home/centos/.bash_profile</span><br><span class="line">/home/centos/.bash_logout   /home/centos/.bashrc</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>if-then-else</code> 双分支语句</p>
<p>  当if语句中的命令返回退出状态码0时，then部分中的命令会被执行，这跟普通的if-then<br>  语句一样。当if语句中的命令返回非零退出状态码时，bash shell会执行else部分中的命令。</p>
<p>  在test.sh文件的基础上添加else语句</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 待测试的用户名为ubuntu</span></span><br><span class="line">testuser=ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时grep命令没有找到ubuntu字符，if语句跳转到else分支</span></span><br><span class="line"><span class="keyword">if</span> grep <span class="variable">$testuser</span> /etc/passwd</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;it worked&quot;</span></span><br><span class="line">        <span class="comment"># 同时显示家目录下以.b开头的隐藏文件</span></span><br><span class="line">        <span class="built_in">ls</span> -a /home/<span class="variable">$testuser</span>/.b*</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user <span class="variable">$testuser</span> does not exist.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>  运行脚本：</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">user ubuntu does not exist.</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>if-then-elif-else</code> 多分支语句</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">testuser=ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> grep <span class="variable">$testuser</span> /etc/passwd</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user: exist&quot;</span></span><br><span class="line">        <span class="built_in">ls</span> -a /home/<span class="variable">$testuser</span>/.b*</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">ls</span> -d /home/<span class="variable">$testuser</span> 2&gt;/dev/null</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user <span class="variable">$testuser</span> does not exist, but has a directory&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user <span class="variable">$testuser</span> does not exist&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;user <span class="variable">$testuser</span> does not have a directory&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>test</code> 命令</p>
<p>  如果test命令中列出的条件成立，test命令就会退出并返回退出状态码0。这样if-then语句就与其他编程语言中的if-then语句以类似的方式工作了。如果条件不成立，test命令就会退出并返回非零的退出状态码，这使得if-then语句不会再被执行。</p>
<ul>
<li><p>test命令格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> condition</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>bash shell提供了另一种条件测试方法，无需在if-then语句中声明test命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>创建脚本test.sh、编辑以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">testuser=ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当变量testuser不为空时执行then语句的内容</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$testuser</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;the variable exists&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>运行脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">the variable exists</span><br></pre></td></tr></table></figure>

<p>方括号定义了测试条件。注意，第一个方括号之后和第二个方括号之前必须加上一个空格，否则就会报错。<br>test命令可以判断三类条件：</p>
<ol>
<li><p>文件比较</p>
<p> 这些测试条件使你能够在shell脚本中检查文件系统中的文件。它们经常出现在需要进行文件访问的脚本中，文件比较的操作符如下：</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-43-25.png" alt="3.Shell条件测试-2023-06-16-20-43-25"></p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>=/home/centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据-d判断dir是否存在并且是一个目录文件</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$dir</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;directory <span class="variable">$dir</span> exists&quot;</span></span><br><span class="line">        <span class="built_in">cd</span> <span class="variable">$dir</span></span><br><span class="line">        <span class="built_in">ls</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">directory /home/centos exists</span><br><span class="line">log.230616  test.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串比较</p>
<p> <img src="https://raw.githubusercontent.com/yefreee/picture/main/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-46-41.png" alt="3.Shell条件测试-2023-06-16-20-46-41"></p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">testuser=centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过比较运算符等号=比较两个字符串，等式成立则表达式结果为真</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$USER</span> = <span class="variable">$testuser</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;welcome <span class="variable">$testuser</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">welcome centos</span><br></pre></td></tr></table></figure>

<ul>
<li>大于号和小于号必须转义，否则shell会把它们当作重定向符号，把字符串值当作文件名</li>
</ul>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">var1=temp</span><br><span class="line">var2=tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在条件比较时直接使用大于号&gt;不能表示大于的含义，需要使用\&gt;在表示大于</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$var1</span> &gt; <span class="variable">$var2</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$var1</span> greater than <span class="variable">$var2</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">temp greater than tmp</span><br></pre></td></tr></table></figure>
</li>
<li><p>数值比较</p>
<p> 数值条件测试可以用在数字和变量上。</p>
<p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-21-06-44.png" alt="3.Shell条件测试-2023-06-16-21-06-44"></p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="复合条件测试"><a href="#复合条件测试" class="headerlink" title="复合条件测试"></a>复合条件测试</h2><ul>
<li><p><code>&amp;&amp;和||</code> 用法</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ condition1 ] &amp;&amp; [ condition2 ]</span><br><span class="line">[ condition1 ] || [ condition2 ]</span><br></pre></td></tr></table></figure>

<ul>
<li>第一种布尔运算使用AND布尔运算符来组合两个条件。要让then部分的命令执行，两个条件都必须满足。</li>
<li>第二种布尔运算使用OR布尔运算符来组合两个条件。如果任意条件为TRUE，then部分的命令就会执行。</li>
</ul>
</li>
</ul>
<h2 id="case命令"><a href="#case命令" class="headerlink" title="case命令"></a>case命令</h2><p>在shell编程中，case语句是一种多分支条件语句，用于测试变量或表达式是否与某些模式匹配，并执行相应的命令。</p>
<p>case语句通常用于替代if-then-else语句，特别是在需要测试一个变量或表达式是否匹配多个模式的情况下。case语句的语法结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> expression <span class="keyword">in</span></span><br><span class="line">  pattern1)</span><br><span class="line">    command1</span><br><span class="line">    ;;</span><br><span class="line">  pattern2)</span><br><span class="line">    command2</span><br><span class="line">    ;;</span><br><span class="line">  pattern3)</span><br><span class="line">    command3</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    default_command</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>其中，expression是要测试的变量或表达式，pattern1、pattern2、pattern3等是匹配模式，command1、command2、command3等是匹配模式成立时要执行的命令，**<code>;;</code><strong>表示命令结束，</strong><code>*)</code>**表示如果所有模式都不匹配时要执行的默认命令。</p>
<p>创建脚本test.sh、编辑以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">fruit=<span class="string">&quot;apple&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$fruit</span> <span class="keyword">in</span></span><br><span class="line">        apple)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;It&#x27;s an apple.&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">        banana)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;It&#x27;s a banana.&quot;</span></span><br><span class="line">                ;;</span><br><span class="line">        <span class="comment"># *用来匹配之前所有匹配模式都匹配不到的情况</span></span><br><span class="line">        *)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;It&#x27;s not an apple or a banana.&quot;</span></span><br><span class="line">                ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>运行脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[centos@host1 ~]$ bash test.sh</span><br><span class="line">It&#x27;s an apple.</span><br></pre></td></tr></table></figure>

<h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><ol>
<li>使用 <code>read</code>要求用户输入一个数字。</li>
<li>使用 <code>if</code>判断该数字是否在<code>0-9</code>之间，如果不满足则停止脚本。</li>
<li>然后使用 <strong><code>case</code></strong> 语句输出对应数字<code>0-3</code>的英文，对于其他数字输出一个提示“该数字在4-9之间”。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/4.Shell%E5%BE%AA%E7%8E%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/4.Shell%E5%BE%AA%E7%8E%AF/" class="post-title-link" itemprop="url">Shell循环</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 21:17:40" itemprop="dateModified" datetime="2023-06-16T21:17:40+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p>上一章学习的结构化命令中的 <code>if-then</code> 和 <code>case</code> 语句，其中 <code>if-then</code> 语句是通过检查命令的执行结果或者表达式（文件比较、字符串比较、数值比较）的结果来控制脚本的执行流程。</p>
<p>在Shell脚本中，循环语句是一种重要的控制结构，用于多次执行同一段代码。Shell脚本中提供了多种循环语句，包括<code>for</code>、<code>while</code>、<code>until</code>三种。</p>
<h2 id="for-循环结构"><a href="#for-循环结构" class="headerlink" title="for 循环结构"></a>for 循环结构</h2><p><code>for</code> 循环是一种针对列表中每个元素执行相同操作的循环结构。该语句会将列表中的每个元素依次赋值给变量，并执行循环体中的语句。其基本语法格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 变量名 <span class="keyword">in</span> 列表</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中，<code>变量名</code>是一个新的变量，用于存储列表中的每个元素；<code>列表</code>是一个由空格分隔的参数列表。</p>
<p>例如，下面的代码中，<code>for</code> 循环遍历了一个包含 5 个元素的列表，依次输出了每个元素：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3 4 5</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;列表中的元素：<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span>,rk</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;i = <span class="variable">$i</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上代码会输出以下结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">列表中的元素：1</span><br><span class="line">列表中的元素：2</span><br><span class="line">列表中的元素：3</span><br><span class="line">列表中的元素：4</span><br><span class="line">列表中的元素：5</span><br><span class="line">i = 5</span><br></pre></td></tr></table></figure>

<ul>
<li><p>读取列表中的复杂值</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> I don<span class="string">&#x27;t know if this&#x27;</span>ll work</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;word:<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>  以上代码输出以下结果：</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">word:I</span><br><span class="line">word:dont know if thisll</span><br><span class="line">word:work</span><br></pre></td></tr></table></figure>

<ul>
<li><p>两种方法解决列表中单引号引用的问题</p>
<ol>
<li><p>使用转义字符（反斜杠）将单引号转义</p>
</li>
<li><p>使用双引号定义用到单引号的值</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> I don\<span class="string">&#x27;t know if this\&#x27;</span>ll work</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;word:<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> I <span class="string">&quot;don&#x27;t&quot;</span> know <span class="keyword">if</span> <span class="string">&quot;this&#x27;ll&quot;</span> work</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;word:<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用双引号引用输出多个单词</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;1 2&quot;</span> <span class="string">&quot;3 4&quot;</span> 5</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;列表中的元素：<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;i = <span class="variable">$i</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>以上代码输出以下结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">列表中的元素：1 2</span><br><span class="line">列表中的元素：3 4</span><br><span class="line">列表中的元素：5</span><br><span class="line">i = 5</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>从变量读取列表</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">list=<span class="string">&quot;1 2 3 4 5&quot;</span></span><br><span class="line">list=<span class="variable">$list</span><span class="string">&quot; 6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$list</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;列表中的元素：<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>  以上代码输出以下结果：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">列表中的元素：1</span><br><span class="line">列表中的元素：2</span><br><span class="line">列表中的元素：3</span><br><span class="line">列表中的元素：4</span><br><span class="line">列表中的元素：5</span><br><span class="line">列表中的元素：6</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过命令读取</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">IFS=$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; test.sh &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">1 2 3</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">4</span></span><br><span class="line"><span class="string">5</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">cat</span> test.sh`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;列表中的元素：<span class="variable">$i</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用通配符读取目录</p>
<p>  在 Shell 编程中，通配符是一种用于匹配文件名或目录名的特殊字符。通配符可以帮助你快速地匹配一组文件或目录，从而方便地对它们进行操作。</p>
<p>  常见的通配符包括：</p>
<ul>
<li><p><code>*</code>：匹配任意长度的任意字符，包括空字符串。</p>
</li>
<li><p><code>?</code>：匹配任意一个字符。</p>
</li>
<li><p><code>[...]</code>：匹配括号内列举的任意一个字符。</p>
</li>
<li><p><code>[^...]</code>：匹配除了括号内列举的任意一个字符以外的所有字符。</p>
<p>以下是一些通配符匹配的示例：</p>
</li>
<li><p><code>*.txt</code>：匹配所有以 <code>.txt</code> 结尾的文件，如 <code>file1.txt</code>、<code>file2.txt</code> 等。</p>
</li>
<li><p><code>file?.txt</code>：匹配所有文件名为 <code>file</code> 开头，后面跟着任意一个字符，最后以 <code>.txt</code> 结尾的文件，如 <code>file1.txt</code>、<code>fileA.txt</code> 等。</p>
</li>
<li><p><code>[abc].txt</code>：匹配所有文件名为 <code>a.txt</code>、<code>b.txt</code>、<code>c.txt</code> 的文件。</p>
</li>
<li><p><code>[^abc].txt</code>：匹配除了文件名为 <code>a.txt</code>、<code>b.txt</code>、<code>c.txt</code> 以外的所有以 <code>.txt</code> 结尾的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> ~/file&#123;1..2&#125;</span><br><span class="line"><span class="built_in">mkdir</span> ~/dir&#123;1..3&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> ~/*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$file</span> is a directory&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$file</span> is a file&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>练习：</p>
<p>通过shell脚本实现批量主机检测</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">&gt;ip.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">    ip=192.168.13.<span class="variable">$i</span></span><br><span class="line">    ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> |<span class="built_in">tee</span> -a ip.txt</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  &#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;finish...&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="while-循环结构"><a href="#while-循环结构" class="headerlink" title="while 循环结构"></a>while 循环结构</h2><p><code>while</code> 循环是一种基于条件判断的循环结构，当条件满足时就会一直执行循环体中的语句。其基本语法格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [ 条件 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中，<code>条件</code>是一个可以执行的测试命令或表达式，如果返回值为0，则为真，循环继续执行；否则为假，循环结束。</p>
<p>例如，下面的代码中，<code>while</code> 循环会一直执行，直到变量 <code>i</code> 的值达到 5：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前变量的值是 <span class="variable">$i</span>&quot;</span></span><br><span class="line">    i=$(( <span class="variable">$i</span> + <span class="number">1</span> ))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上代码会输出以下结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当前变量的值是 1</span><br><span class="line">当前变量的值是 2</span><br><span class="line">当前变量的值是 3</span><br><span class="line">当前变量的值是 4</span><br><span class="line">当前变量的值是 5</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="until-循环结构"><a href="#until-循环结构" class="headerlink" title="until 循环结构"></a>until 循环结构</h2><p><code>until</code> 循环与 <code>while</code> 循环类似，但是只有当条件为假时才会执行循环体中的语句。其基本语法格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">until</span> [ 条件 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中，<code>条件</code>是一个可以执行的测试命令或表达式，如果返回值为0，则为假，循环继续执行；否则为真，循环结束。</p>
<p>例如，下面的代码中，<code>until</code> 循环会一直执行，直到变量 <code>i</code> 的值达到 5：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">until</span> [ <span class="variable">$i</span> -gt 5 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;当前变量的值是 <span class="variable">$i</span>&quot;</span></span><br><span class="line">    i=$(( <span class="variable">$i</span> + <span class="number">1</span> ))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上代码会输出以下结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当前变量的值是 1</span><br><span class="line">当前变量的值是 2</span><br><span class="line">当前变量的值是 3</span><br><span class="line">当前变量的值是 4</span><br><span class="line">当前变量的值是 5</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="循环控制语句结构"><a href="#循环控制语句结构" class="headerlink" title="循环控制语句结构"></a>循环控制语句结构</h2><p>在循环中，有时需要跳过某些循环或终止循环的执行，Shell脚本提供了以下三种循环控制语句：</p>
<ul>
<li><code>break</code>语句：用于强制退出循环，跳出循环体，执行循环后面的语句。</li>
<li><code>continue</code>语句：用于跳过循环体中的一个迭代，直接进入下一个迭代。</li>
<li><code>return</code>语句：用于退出函数，返回到函数调用处。</li>
</ul>
<p>例如，下面的代码演示了如何在循环中使用 <code>break</code> 和 <code>continue</code> 语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$i</span> -eq 3 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;跳过第 <span class="variable">$i</span> 次迭代&quot;</span></span><br><span class="line">        i=$(( <span class="variable">$i</span> + <span class="number">1</span> ))</span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$i</span> -eq 5 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;退出循环&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;第 <span class="variable">$i</span> 次迭代&quot;</span></span><br><span class="line">    i=$(( <span class="variable">$i</span> + <span class="number">1</span> ))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上代码会输出以下结果：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第 1 次迭代</span><br><span class="line">第 2 次迭代</span><br><span class="line">跳过第 3 次迭代</span><br><span class="line">第 4 次迭代</span><br><span class="line">退出循环</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/5.%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/5.%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/" class="post-title-link" itemprop="url">处理用户输入</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 21:20:43" itemprop="dateModified" datetime="2023-06-16T21:20:43+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>bash shell提供了一些不同的方法从用户处获得数据，包括命令行参数、命令行选项、直接从键盘读取。</li>
</ul>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><h3 id="读取参数"><a href="#读取参数" class="headerlink" title="读取参数"></a>读取参数</h3><p>在Shell脚本中，命令行参数可以通过特殊变量 <strong><code>$1</code><strong>、</strong><code>$2</code><strong>、</strong><code>$3</code></strong> … **<code>$n</code>**来获取，其中 **<code>$1</code><strong>表示第一个参数，</strong><code>$2</code><strong>表示第二个参数，以此类推，</strong><code>$n</code>**表示第 n 个参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第一个参数为：<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第二个参数为：<span class="variable">$2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;第三个参数为：<span class="variable">$3</span>&quot;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>利用<code>for</code>循环和命令行参数计算阶乘：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">n=<span class="variable">$1</span></span><br><span class="line">fact=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">1</span>; i&lt;=<span class="variable">$n</span>; i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   fact=$((fact * i))  </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Factorial of <span class="variable">$n</span> is <span class="variable">$fact</span>&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>将带有空格的文本字符串传递给脚本时需要注意用引号，引号在进行传递时只表明数据的起止位置，不作为数据的一部分：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Hello <span class="variable">$1</span>, glad to meet you.</span><br></pre></td></tr></table></figure>
</li>
<li><p>当参数超过9个时需要修改变量名，变量名两侧加上花括号。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># handling lots of parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">total=$[ <span class="variable">$&#123;10&#125;</span> * <span class="variable">$&#123;11&#125;</span> ]</span><br><span class="line"><span class="built_in">echo</span> The tenth parameter is <span class="variable">$&#123;10&#125;</span></span><br><span class="line"><span class="built_in">echo</span> The eleventh parameter is <span class="variable">$&#123;11&#125;</span></span><br><span class="line"><span class="built_in">echo</span> The total is <span class="variable">$total</span></span><br></pre></td></tr></table></figure>

<p> 运行脚本：</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The tenth parameter is 10</span><br><span class="line">The eleventh parameter is 11</span><br><span class="line">The total is 110</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="读取脚本名"><a href="#读取脚本名" class="headerlink" title="读取脚本名"></a>读取脚本名</h3><p>可以用<code>$0</code>参数获取shell在命令行启动的脚本名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the $0 parameter</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> The zero parameter is <span class="built_in">set</span> to: <span class="variable">$0</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>当传给<code>$0</code>变量的实际字符串不仅仅是脚本名，而是完整的脚本路径时，变量<code>$0</code>就会使用整个路径：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ bash ~/temp.sh</span><br><span class="line">The zero parameter is set to: /home/ubuntu/temp.sh</span><br></pre></td></tr></table></figure>

<p>basename命令会返回不包含路径的脚本名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Testing the $0 parameter</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">name=$(<span class="built_in">basename</span> <span class="variable">$0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> The zero parameter is <span class="built_in">set</span> to: <span class="variable">$name</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>基于脚本名实现不同功能的脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Testing a Multi-function script</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">name=$(<span class="built_in">basename</span> <span class="variable">$0</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$name</span> = <span class="string">&quot;addem&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">total=$[ <span class="variable">$1</span> + <span class="variable">$2</span> ]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$name</span> = <span class="string">&quot;multem&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">total=$[ <span class="variable">$1</span> * <span class="variable">$2</span> ]</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> The calculated value is <span class="variable">$total</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> temp.sh addem</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ln</span> -s temp.sh multem</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bash addem 2 5</span></span><br><span class="line">The calculated value is 7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bash multem 2 5</span></span><br><span class="line">The calculated value is 10</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br></pre></td></tr></table></figure>

<h3 id="测试参数"><a href="#测试参数" class="headerlink" title="测试参数"></a>测试参数</h3><p>在脚本内使用参数时需要考虑到当用户输入错误参数时的情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">n=<span class="variable">$1</span></span><br><span class="line">fact=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Factorial of 0 is 1&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$n</span> -lt 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Invalid input. Number must be a positive integer&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>; i&lt;=<span class="variable">$n</span>; i++)); <span class="keyword">do</span></span><br><span class="line">  fact=$((fact * i))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Factorial of <span class="variable">$n</span> is <span class="variable">$fact</span>&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<h2 id="特殊参数变量"><a href="#特殊参数变量" class="headerlink" title="特殊参数变量"></a>特殊参数变量</h2><h3 id="参数统计"><a href="#参数统计" class="headerlink" title="参数统计"></a>参数统计</h3><p>使用特殊变量可以帮助我们更方便的检查用户传递给脚本的参数。特殊变量<code>$#</code>含有脚本运行时携带的命令行参数的个数。可以在脚本中任何地方使用这个特殊变量，就跟普通变量一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># getting the number of parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> There were <span class="variable">$#</span> parameters supplied.</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ bash temp.sh</span><br><span class="line">There were 0 parameters supplied.</span><br><span class="line"></span><br><span class="line">ubuntu@sh:~$ bash temp.sh 1 2 3 4 5</span><br><span class="line">There were 5 parameters supplied.</span><br><span class="line"></span><br><span class="line">ubuntu@sh:~$ bash temp.sh &quot;Hello world&quot;</span><br><span class="line">There were 1 parameters supplied.</span><br></pre></td></tr></table></figure>

<p>在使用参数前测试参数总数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> number&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">n=<span class="variable">$1</span></span><br><span class="line">fact=1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Factorial of 0 is 1&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$n</span> -lt 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Invalid input. Number must be a positive integer&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>; i&lt;=<span class="variable">$n</span>; i++)); <span class="keyword">do</span></span><br><span class="line">  fact=$((fact * i))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Factorial of <span class="variable">$n</span> is <span class="variable">$fact</span>&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<h3 id="抓取所有的数据"><a href="#抓取所有的数据" class="headerlink" title="抓取所有的数据"></a>抓取所有的数据</h3><p><code>$*</code>变量会将命令行上提供的所有参数当作一个单词保存。这个单词包含了命令行中出现的每<br>一个参数值。基本上<code>$*</code>变量会将这些参数视为一个整体，而不是多个个体。<br>另一方面，<code>$@</code>变量会将命令行上提供的所有参数当作同一字符串中的多个独立的单词。这样<br>你就能够遍历所有的参数值，得到每个参数。这通常通过<code>for</code>命令完成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># testing $* and $@</span></span><br><span class="line"><span class="comment">#j,r:</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">count=1</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">&quot;$*&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\$* Parameter #<span class="variable">$count</span> = <span class="variable">$param</span>&quot;</span></span><br><span class="line">count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">count=1</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\$@ Parameter #<span class="variable">$count</span> = <span class="variable">$param</span>&quot;</span></span><br><span class="line">count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="移动变量"><a href="#移动变量" class="headerlink" title="移动变量"></a>移动变量</h2><p>bash shell的<code>shift</code>命令能够用来操作命令行参数。在使用<code>shift</code>命令时，默认情况下它会将每个参数变量向左移动一个位置。所以，变量<code>$3</code>的值会移到$2中，变量<code>$2</code>的值会移到<code>$1</code>中，而变量<code>$1</code>的值则会被删除（注意，变量<code>$0</code>的值，也就是程序名，不会改变）。</p>
<p>这是遍历命令行参数的另一个好方法，尤其是在你不知道到底有多少参数时。你可以只操作第一个参数，移动参数，然后继续操作第一个参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">                <span class="built_in">sum</span>=$((<span class="variable">$sum</span>+<span class="variable">$1</span>))</span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">sum</span>=<span class="variable">$sum</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ bash temp.sh 1 2 3</span><br><span class="line">sum=6</span><br><span class="line"></span><br><span class="line">ubuntu@sh:~$ bash temp.sh 1 2 3 4 5 6</span><br><span class="line">sum=21</span><br></pre></td></tr></table></figure>

<h2 id="处理选项"><a href="#处理选项" class="headerlink" title="处理选项"></a>处理选项</h2><p>选项是跟在单破折线后面的单个字母，它能改变命令的行为。</p>
<h3 id="处理简单选项"><a href="#处理简单选项" class="headerlink" title="处理简单选项"></a>处理简单选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">         <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                                -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span> ;;</span><br><span class="line">                                -b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option&quot;</span> ;;</span><br><span class="line">                                -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span> ;;</span><br><span class="line">                                *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span> ;;</span><br><span class="line">         <span class="keyword">esac</span></span><br><span class="line">         <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="分离参数和选项、处理带值选项"><a href="#分离参数和选项、处理带值选项" class="headerlink" title="分离参数和选项、处理带值选项"></a>分离参数和选项、处理带值选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># extracting options and parameters</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                                -a) <span class="built_in">echo</span> <span class="string">&quot;Found the -a option&quot;</span> ;;</span><br><span class="line">                                -b) <span class="built_in">echo</span> <span class="string">&quot;Found the -b option&quot;</span>;;</span><br><span class="line">                                -c) <span class="built_in">echo</span> <span class="string">&quot;Found the -c option&quot;</span> </span><br><span class="line">                   coption=$(<span class="variable">$2</span> * <span class="variable">$3</span>)</span><br><span class="line">                   <span class="built_in">echo</span> <span class="variable">$coption</span></span><br><span class="line">                   <span class="built_in">shift</span></span><br><span class="line">                   <span class="built_in">shift</span></span><br><span class="line">                   ;;</span><br><span class="line">                                --) <span class="built_in">shift</span></span><br><span class="line">                                                <span class="built_in">break</span> ;;</span><br><span class="line">                                *) <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> is not an option&quot;</span>;;</span><br><span class="line">                <span class="keyword">esac</span></span><br><span class="line">                <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">for</span> param <span class="keyword">in</span> <span class="variable">$@</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Parameter #<span class="variable">$count</span>: <span class="variable">$param</span>&quot;</span></span><br><span class="line">                count=$(( <span class="variable">$count</span> + <span class="number">1</span> ))</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="利用选项和参数实现阶乘和求和的计算工具"><a href="#利用选项和参数实现阶乘和求和的计算工具" class="headerlink" title="利用选项和参数实现阶乘和求和的计算工具"></a>利用选项和参数实现阶乘和求和的计算工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ] || [ <span class="variable">$#</span> -eq 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;sum and factorial tool&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Usage:&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;          -a number ...&quot;</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;          -f number&quot;</span></span><br><span class="line">                <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">                -a)</span><br><span class="line">                                <span class="keyword">while</span> [ -n <span class="string">&quot;<span class="variable">$2</span>&quot;</span> ]</span><br><span class="line">                                <span class="keyword">do</span></span><br><span class="line">                                                <span class="built_in">sum</span>=$[<span class="variable">$sum</span> + <span class="variable">$2</span>]</span><br><span class="line">                                                <span class="built_in">shift</span></span><br><span class="line">                                <span class="keyword">done</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;sum=<span class="variable">$sum</span>&quot;</span></span><br><span class="line">                                <span class="built_in">exit</span> 0</span><br><span class="line"><span class="comment"># shift</span></span><br><span class="line"><span class="comment"># for i in $@</span></span><br><span class="line"><span class="comment"># do</span></span><br><span class="line"> <span class="comment"># sum=$((sum + i))</span></span><br><span class="line"><span class="comment"># done</span></span><br><span class="line"><span class="comment"># exit 0</span></span><br><span class="line">                                ;;</span><br><span class="line">                -f)</span><br><span class="line">                                <span class="keyword">if</span> [ <span class="variable">$2</span> -eq 0 ]</span><br><span class="line">                                <span class="keyword">then</span></span><br><span class="line">                                                <span class="built_in">echo</span> <span class="string">&quot;fact=1&quot;</span></span><br><span class="line">                                                <span class="built_in">exit</span> 0</span><br><span class="line">                                <span class="keyword">fi</span></span><br><span class="line">                                fact=1</span><br><span class="line">                                <span class="keyword">for</span>((i=<span class="number">1</span>; i&lt;=<span class="variable">$2</span>; i++))</span><br><span class="line">                                <span class="keyword">do</span></span><br><span class="line">                                                fact=$[<span class="variable">$fact</span> * <span class="variable">$i</span>]</span><br><span class="line">                                <span class="keyword">done</span></span><br><span class="line">                                <span class="built_in">echo</span> fact=<span class="variable">$fact</span></span><br><span class="line">                                <span class="built_in">exit</span> 0</span><br><span class="line">                                ;;</span><br><span class="line">                -h)</span><br><span class="line">                                ;;</span><br><span class="line">                *)</span><br><span class="line">                                <span class="built_in">echo</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;sum and factorial tool&quot;</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;Usage:&quot;</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;          -a number ...&quot;</span></span><br><span class="line">                                <span class="built_in">echo</span> <span class="string">&quot;          -f number&quot;</span></span><br><span class="line">                                ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<h2 id="标准化选项"><a href="#标准化选项" class="headerlink" title="标准化选项"></a>标准化选项</h2><p><img src="https://raw.githubusercontent.com/yefreee/picture/main/note5.%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5-2023-06-16-21-20-42.png" alt="5.处理用户输入-2023-06-16-21-20-42"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/6.%E4%BD%BF%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%91%88%E7%8E%B0%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/6.%E4%BD%BF%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%91%88%E7%8E%B0%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">使用重定向呈现数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-06-16 21:21:38" itemprop="dateModified" datetime="2023-06-16T21:21:38+08:00">2023-06-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>有些时候想要保存某个命令的输出而不仅仅只是让它显示在显示器上。 <code>bash shell</code>提供了几个操作符，可以将命令的输出重定向到另一个位置（比如文件）。重定向可以用于输入，也可以用于输出，可以将文件重定向到命令输入。</p>
<h2 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ date &gt; test6</span><br><span class="line">ubuntu@sh:~$ ls -l test6</span><br><span class="line">-rw-rw-r-- 1 ubuntu ubuntu 29 Mar 26 19:23 test6</span><br><span class="line">ubuntu@sh:~$ cat test6</span><br><span class="line">Sun Mar 26 19:23:54 PDT 2023</span><br><span class="line">ubuntu@sh:~$</span><br></pre></td></tr></table></figure>

<p>重定向操作符创建了一个文件 <code>test6</code>（通过默认的 <code>umask</code>设置），并将 <code>date</code>命令的输出重定向到该文件中。如果输出文件已经存在了，重定向操作符会用新的文件数据覆盖已有文件。</p>
<p>有时，可能并不想覆盖文件原有内容，而是想要将命令的输出追加到已有文件中，比如正在创建一个记录系统上某个操作的日志文件。在这种情况下，可以用双大于号 <code>（&gt;&gt;）</code>来追加数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ who &gt;&gt; test6</span><br><span class="line">ubuntu@sh:~$ cat test6</span><br><span class="line">Sun Mar 26 19:23:54 PDT 2023</span><br><span class="line">ubuntu   tty1         2023-03-26 19:01</span><br><span class="line">ubuntu   pts/0        2023-03-26 19:01 (192.168.13.1)</span><br><span class="line">ubuntu@sh:~$</span><br></pre></td></tr></table></figure>

<p><code>test6</code>文件在原来<code>who</code>命令输出的基础上又加上了<code>date</code>命令的输出</p>
<h2 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h2><p>输入重定向和输出重定向正好相反。输入重定向将文件的内容重定向到命令，而非将命令的输出重定向到文件。输入重定向符号是小于号<code>（&lt;）</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~<span class="variable">$</span> <span class="built_in">cat</span> test6</span><br><span class="line">Sun Mar <span class="number">26</span> <span class="number">19</span>:<span class="number">23</span>:<span class="number">54</span> PDT <span class="number">2023</span></span><br><span class="line">ubuntu   tty1         <span class="number">2023</span><span class="literal">-03-26</span> <span class="number">19</span>:<span class="number">01</span></span><br><span class="line">ubuntu   pts/<span class="number">0</span>        <span class="number">2023</span><span class="literal">-03-26</span> <span class="number">19</span>:<span class="number">01</span> (<span class="number">192.168</span>.<span class="number">13.1</span>)</span><br><span class="line">ubuntu@sh:~<span class="variable">$</span> wc &lt; test6</span><br><span class="line">  <span class="number">3</span>  <span class="number">15</span> <span class="number">122</span></span><br><span class="line">ubuntu@sh:~<span class="variable">$</span></span><br></pre></td></tr></table></figure>

<p><code>wc</code>命令可以对对数据中的文本进行计数。默认情况下，它会输出3个值：文本的行数，文本的词数，文本的字节数。</p>
<h2 id="呈现数据"><a href="#呈现数据" class="headerlink" title="呈现数据"></a>呈现数据</h2><h3 id="标准文件描述符"><a href="#标准文件描述符" class="headerlink" title="标准文件描述符"></a>标准文件描述符</h3><p>Linux的标准文件描述符：</p>
<table>
<thead>
<tr>
<th>文件描述符</th>
<th>缩写</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>STDIN</td>
<td>标准输入</td>
</tr>
<tr>
<td>1</td>
<td>STDOUT</td>
<td>标准输出</td>
</tr>
<tr>
<td>2</td>
<td>STDERR</td>
<td>标准错误</td>
</tr>
</tbody></table>
<ul>
<li>这三个特殊文件描述符会处理脚本的输入和输出。shell用它们将shell默认的输入和输出导向到相应的位置。</li>
</ul>
<ol>
<li><p>STDIN(标准输入)</p>
<p> STDIN文件描述符代表<code>shell</code>的标准输入。对终端界面来说，标准输入是键盘。shell从STDIN文件描述符对应的键盘获得输入，在用户输入时处理每个字符。</p>
<p> 在使用输入重定向符号<code>（&lt;）</code>时，Linux会用重定向指定的文件来替换标准输入文件描述符。它会读取文件并提取数据，就如同它是键盘上键入的。</p>
<p> 当在命令行上只输入<code>cat</code>命令时，它会从<code>STDIN</code>接受输入。输入一行，<code>cat</code>命令就会显示出一行。<br> 但你也可以通过<code>STDIN</code>重定向符号强制<code>cat</code>命令接受来自另一个<code>非STDIN</code>文件的输入。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ cat &lt; test6</span><br><span class="line">Sun Mar 26 19:23:54 PDT 2023</span><br><span class="line">ubuntu   tty1         2023-03-26 19:01</span><br><span class="line">ubuntu   pts/0        2023-03-26 19:01 (192.168.13.1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>STDOUT(标准输出)</p>
<p> <code>STDOUT</code>文件描述符代表<code>shell</code>的标准输出。在终端界面上，标准输出就是终端显示器。<code>shell</code>的所有输出（包括<code>shell</code>中运行的程序和脚本）会被定向到标准输出中，也就是显示器。</p>
<p> 默认情况下，大多数bash命令会将输出导向STDOUT文件描述符。我们也可以使用<code>&gt;</code>将输出重定向到文件。</p>
<p> 当命令生成错误消息时，shell并未将错误消息重定向到输出重定向文件。shell创建了输出重定向文件，但错误消息却显示在了显示器屏幕上。注意，在显示test3文件的内容时并没有任何错误。test3文件创建成功了，只是里面是空的。shell对于错误消息的处理是跟普通输出分开的。如果创建了在后台模式下运行的shell脚本，通常必须依赖发送到日志文件的输出消息。用这种方法的话，如果出现了错误信息，这些信息是不会出现在日志文件中的。需要换种方法来处理。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ ls -al badfile &gt; test3</span><br><span class="line">ls: cannot access &#x27;badfile&#x27;: No such file or directory</span><br><span class="line">ubuntu@sh:~$ cat test3</span><br><span class="line">ubuntu@sh:~$</span><br></pre></td></tr></table></figure>
</li>
<li><p>STDERR(标准错误)</p>
<p> shell通过特殊的STDERR文件描述符来处理错误消息。STDERR文件描述符代表shell的标准错误输出。shell或shell中运行的程序和脚本出错时生成的错误消息都会发送到这个位置。默认情况下，STDERR文件描述符会和STDOUT文件描述符指向同样的地方（尽管分配给它们的文件描述符值不同）。也就是说，默认情况下，错误消息也会输出到显示器输出中。但从上面的例子可以看出，STDERR并不会随着STDOUT的重定向而发生改变。使用脚本时，常常会想改变这种行为，尤其是当希望将错误消息保存到日志文件中的时候。</p>
</li>
</ol>
<h3 id="重定向错误"><a href="#重定向错误" class="headerlink" title="重定向错误"></a>重定向错误</h3><ul>
<li><p>只重定向错误</p>
<p>  STDERR文件描述符被设成2。可以选择只重定向错误消息，将该文件描述符值放在重定向符号前。</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ ls -al badfile 2&gt; test3</span><br><span class="line">ubuntu@sh:~$ cat test3</span><br><span class="line">ls: cannot access &#x27;badfile&#x27;: No such file or directory</span><br><span class="line">ubuntu@sh:~$</span><br></pre></td></tr></table></figure>
</li>
<li><p>重定向错误和数据</p>
<p>  如果想重定向错误和正常输出，必须用两个重定向符号。需要在符号前面放上待重定向数据所对应的文件描述符，然后指向用于保存数据的输出文件。</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ ls -al test3 test6 badtest 2&gt;test7 1&gt;test8</span><br><span class="line">ubuntu@sh:~$ cat test7</span><br><span class="line">ls: cannot access &#x27;badtest&#x27;: No such file or directory</span><br><span class="line">ubuntu@sh:~$ cat test8</span><br><span class="line">-rw-rw-r-- 1 ubuntu ubuntu  55 Mar 26 20:24 test3</span><br><span class="line">-rw-rw-r-- 1 ubuntu ubuntu 122 Mar 26 19:27 test6</span><br><span class="line">ubuntu@sh:~$</span><br></pre></td></tr></table></figure>

<p>  shell利用<code>1&gt;</code>符号将ls命令的正常输出重定向到了test8文件，而这些输出本该是进入<code>STDOUT</code>的。所有本该输出到<code>STDERR</code>的错误消息通过<code>2&gt;</code>符号被重定向到了test7文件。</p>
<p>  可以用这种方法将脚本的正常输出和脚本生成的错误消息分离开来。这样就可以轻松地识别出错误信息。另外也可以将<code>STDERR</code>和<code>STDOUT</code>的输出重定向到同一个输出文件。为此<code>bash shell</code>提供了特殊的重定向符号<code>&amp;&gt;</code>。</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ ls -al badtest test3 test6 badtest &amp;&gt; test7</span><br><span class="line">ubuntu@sh:~$ cat test7</span><br><span class="line">ls: cannot access &#x27;badtest&#x27;: No such file or directory</span><br><span class="line">ls: cannot access &#x27;badtest&#x27;: No such file or directory</span><br><span class="line">-rw-rw-r-- 1 ubuntu ubuntu  55 Mar 26 20:24 test3</span><br><span class="line">-rw-rw-r-- 1 ubuntu ubuntu 122 Mar 26 19:27 test6</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="在脚本中重定向输出"><a href="#在脚本中重定向输出" class="headerlink" title="在脚本中重定向输出"></a>在脚本中重定向输出</h2><p>可以在脚本中用STDOUT和STDERR文件描述符以在多个位置生成输出，只要简单地重定向相应的文件描述符就行了。有两种方法来在脚本中重定向输出：</p>
<ol>
<li>临时重定向行输出</li>
<li>永久重定向脚本中的所有命令</li>
</ol>
<h3 id="临时重定向"><a href="#临时重定向" class="headerlink" title="临时重定向"></a>临时重定向</h3><p>如果有意在脚本中生成错误消息，可以将单独的一行输出重定向到STDERR。所需要做的是使用输出重定向符来将输出信息重定向到STDERR文件描述符。在重定向到文件描述符时，必须在文件描述符数字之前加一个&amp;：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ cat test.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo &quot;This is an error&quot; &gt;&amp;2</span><br><span class="line">echo &quot;This is normal output&quot;</span><br><span class="line"></span><br><span class="line">ubuntu@sh:~$ bash test.sh 2&gt; test9</span><br><span class="line">This is normal output</span><br><span class="line">ubuntu@sh:~$ cat test9</span><br><span class="line">This is an error</span><br></pre></td></tr></table></figure>

<h3 id="永久重定向"><a href="#永久重定向" class="headerlink" title="永久重定向"></a>永久重定向</h3><p>如果脚本中有大量数据需要重定向，那重定向每个echo语句就会很烦琐，用exec命令告诉shell在脚本执行期间重定向某个特定文件描述符，exec命令会启动一个新shell并将STDOUT文件描述符重定向到文件。脚本中发给STDOUT的所有输出会被重定向到文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># redirecting all output to a file</span></span><br><span class="line"><span class="built_in">exec</span> 1&gt;testout</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is a test of redirecting all output&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;from a script to another file.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;without having to redirect every individual line&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ bash test.sh</span><br><span class="line">ubuntu@sh:~$ cat testout</span><br><span class="line">This is a test of redirecting all output</span><br><span class="line">from a script to another file.</span><br><span class="line">without having to redirect every individual line</span><br></pre></td></tr></table></figure>

<ul>
<li><p>脚本执行过程中重定向</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># redirecting output to different locations</span></span><br><span class="line"><span class="built_in">exec</span> 2&gt;testerror</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This is the start of the script&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;now redirecting all output to another location&quot;</span></span><br><span class="line"><span class="built_in">exec</span> 1&gt;testout</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This output should go to the testout file&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;but this should go to the testerror file&quot;</span> &gt;&amp;2</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="在脚本中重定向输入"><a href="#在脚本中重定向输入" class="headerlink" title="在脚本中重定向输入"></a>在脚本中重定向输入</h2><p>可以使用与脚本中重定向STDOUT和STDERR相同的方法来将STDIN从键盘重定向到其他位置。exec命令允许将STDIN重定向到Linux系统上的文件中。这个重定向只要在脚本需要输入时就会作用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># redirecting file input</span></span><br><span class="line"><span class="built_in">exec</span> 0&lt; testfile</span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Line #<span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="创建自己的重定向"><a href="#创建自己的重定向" class="headerlink" title="创建自己的重定向"></a>创建自己的重定向</h2><h3 id="创建输出文件描述符"><a href="#创建输出文件描述符" class="headerlink" title="创建输出文件描述符"></a>创建输出文件描述符</h3><p>在脚本中重定向输入和输出时，并不局限于这3个默认的文件描述符。在shell中最多可以有9个打开的文件描述符。其他6个从3~8的文件描述符均可用作输入或输出重定向。可以将这些文件描述符中的任意一个分配给文件，然后在脚本中使用它们。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># using an alternative file descriptor</span></span><br><span class="line"><span class="built_in">exec</span> 3&gt;test3out</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This should display on the monitor&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;and this should be stored in the file&quot;</span> &gt;&amp;3</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Then this should be back on the monitor&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建输入文件描述符"><a href="#创建输入文件描述符" class="headerlink" title="创建输入文件描述符"></a>创建输入文件描述符</h3><p>可以用和重定向输出文件描述符同样的办法重定向输入文件描述符。在重定向到文件之前，先将STDIN文件描述符保存到另外一个文件描述符，然后在读取完文件之后再将STDIN恢复到它原来的位置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># redirecting input file descriptors</span></span><br><span class="line"><span class="built_in">exec</span> 6&lt;&amp;0</span><br><span class="line"><span class="built_in">exec</span> 0&lt; testfile</span><br><span class="line">count=1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Line #<span class="variable">$count</span>: <span class="variable">$line</span>&quot;</span></span><br><span class="line">count=$[ <span class="variable">$count</span> + 1 ]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exec</span> 0&lt;&amp;6</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Are you done now? &quot;</span> answer</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$answer</span> <span class="keyword">in</span></span><br><span class="line">Y|y) <span class="built_in">echo</span> <span class="string">&quot;Goodbye&quot;</span>;;</span><br><span class="line">N|n) <span class="built_in">echo</span> <span class="string">&quot;Sorry, this is the end.&quot;</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h2 id="组织命令输出"><a href="#组织命令输出" class="headerlink" title="组织命令输出"></a>组织命令输出</h2><p>有时候，可能不想显示脚本的输出。这在将脚本作为后台进程运行时很常见。可以将STDERR重定向到一个叫作null文件的特殊&#x2F;文件。shell输出到null文件的任何数据都不会保存，全部都被丢掉了。在Linux系统上null文件的标准位置是&#x2F;dev&#x2F;null。你重定向到该位置的任何数据都会被丢掉，不会显示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@sh:~$ <span class="built_in">ls</span> -al &gt; /dev/null</span><br><span class="line">ubuntu@sh:~$</span><br><span class="line">ubuntu@sh:~$ <span class="built_in">ls</span> -al badfile 2&gt; /dev/null</span><br><span class="line">ubuntu@sh:~$</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/source/index.md/page/2/">2</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/source/index.md/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
